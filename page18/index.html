<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

    <title>James Gregory</title>
    <meta name="description" content="Code monkey. ThoughtWorks. Chief Agitator.
" />

    <meta name="HandheldFriendly" content="True" />
    <meta name="MobileOptimized" content="320" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" type="text/css" href="/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400" />
    <!-- Customisation  -->
    <link rel="stylesheet" type="text/css" href="/css/main.css" />

</head>
<body class="home-template">

    <header class="main-header no-cover">
    <div class="vertical">
        <div class="main-header-content inner">
            <h1 class="page-title"><a href="/">James Gregory</a></h1>
            <h2 class="page-description">
                 Code monkey. ThoughtWorks. Chief Agitator.
 
            </h2>
        </div>
    </div>
    <a class="scroll-down icon-arrow-left" href="#content" data-offset="-45"><span class="hidden">Scroll Down</span></a>
</header>

<main id="content" class="content" role="main">
    <div class="extra-pagination inner">
        <nav class="pagination" role="pagination">
    
        
            <a class="newer-posts" href="/page17/" title="Previous Page">&laquo; Newer Posts</a>
      
    
    <span class="page-number"> Page 18 of 23 </span>
     
        <a class="older-posts" href="/page19/" title="Next Page">Older Posts &raquo;</a>
     
</nav>
    </div>

    

    <article class="post">
        <header class="post-header">
            <h2 class="post-title"><a href="/writings/the-problem-with-onload">The problem with onload</a></h2>
        </header>
        <section class="post-excerpt">
            <p>Handling events from within your page has always been a hit and miss affair, especially for somebody who doesn’t like mixing their code and markup. The way to go with events for a long time was to embed an attribute on the element in question; like <code>onclick="do_something()"</code>.</p>

<p>That works fine, but we sure know it isn’t semantic. The way forward — greatly popularised by the <a href="http://prototype.conio.net">Prototype</a>, <a href="http://dojotoolkit.org/">Dojo</a> and <a href="http://bennolan.com/behaviour/">Behaviour</a> libraries — is to use DOM compliant event listeners. These fire arbitrary code, in a very similar way to attributes, when an event is raised. Unlike attributes these event listeners can be hidden away in their rightful place, the document header.</p>

<p>Perfect - clean semantic markup and real event handling.</p>

<p>…or is it? Unfortunately nothing is ever smooth when dealing with standards (it’s hard to promote the underdog when the underdog barely works anyway…).</p>

<h2 id="our-problem">Our Problem</h2>

<p>The biggest setback for using event listeners is that nothing will fire until the whole of the body has finished loading, including any images that need to be downloaded. This can cause something similar to the <a href="http://www.bluerobot.com/web/css/fouc.asp" title="Flash of Unstyled Content">FOUC</a>, where a page appears in one state for a moment until the javascript executes; not a pretty sight and generally hard to sell as a browser fault.</p>

<p>If you had the following code in your header tag, the element <code>aTable</code> would be visible until the page has finished loading, at which point it would suddenly disappear.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;</span>
  <span class="kd">function</span> <span class="nx">hideATable</span><span class="p">()</span> <span class="p">{</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'aTable'</span><span class="p">).</span><span class="nx">style</span><span class="p">[</span><span class="s1">'display'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'none'</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">Event</span><span class="p">.</span><span class="nx">observe</span><span class="p">(</span><span class="nb">window</span><span class="p">,</span> <span class="s1">'load'</span><span class="p">,</span> <span class="nx">hideATable</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
<span class="nt">&lt;/script&gt;</span>
</code></pre>
</div>

<p>What we really need is an <code>onBodyRendered</code> event to hook to, which fires as soon as the body has been parsed, irrelevant of whether the content has been loaded.</p>

<h2 id="the-solution">The Solution</h2>
<p>The only real solution to this problem, as there isn’t an <code>onBodyRendered</code> event, is to force the browser to parse our javascript before it has finished loading. The method of doing this is to embed a script block just before the end of the body tag containing the functions you wish to execute. The reason this works is because the browser parses any javascript it encounters within the body tag and evaluates it while rendering.</p>

<p>The following code would hide the table before the page has finished rendering; exactly what we want.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;</span>
  <span class="nx">hideATable</span><span class="p">();</span>
<span class="nt">&lt;/script&gt;</span>
</code></pre>
</div>

<h2 id="my-additions">My additions</h2>

<p>The above method isn’t completely desirable, because it is still mixing code with markup and any code within the footer will not be cached. There isn’t much you can do about that really, but one thing that i’ve taken to doing in my websites is to make sure there is only ever one function call in that footer script block.</p>

<p>My method of doing such a thing is to create a special object that represents all my pages and their individual footer script blocks. You can see below an example of such an object, there’s an wrapper object that allows for further extensions (such as Unload or Validation sections) and then the Load object that contains each pages onload function. Each page then has a single line script block like <code class="highlighter-rouge">Pages.Load.Home();</code></p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">Pages</span> <span class="o">=</span> <span class="p">{};</span>

<span class="nx">Pages</span><span class="p">.</span><span class="nx">Load</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">Home</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">highlightSomething</span><span class="p">();</span>
    <span class="nx">hideSomething</span><span class="p">();</span>
    <span class="nx">saveCookies</span><span class="p">();</span>
  <span class="p">},</span>

  <span class="na">Portfolio</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">hideSomething</span><span class="p">();</span>
    <span class="nx">makeMeLookGood</span><span class="p">();</span>
  <span class="p">},</span>

  <span class="na">Contact</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">highlightFields</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre>
</div>

<p>So the above code is stored in an external js file and loaded in the usual way, thus being cached.</p>

<h3 id="before">Before:</h3>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;</span>
  <span class="nx">highlightSomething</span><span class="p">();</span>
  <span class="nx">hideSomething</span><span class="p">();</span>
  <span class="nx">saveCookies</span><span class="p">();</span>
<span class="nt">&lt;/script&gt;</span>
</code></pre>
</div>

<h3 id="after">After:</h3>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;</span>
  <span class="nx">Pages</span><span class="p">.</span><span class="nx">Load</span><span class="p">.</span><span class="nx">Home</span><span class="p">();</span>
<span class="nt">&lt;/script&gt;</span>
</code></pre>
</div>

 <a class="read-more" href="/writings/the-problem-with-onload">Read more &raquo;</a>
        </section>
        <footer class="post-meta">
            
            
            <time class="post-date" datetime="2006-04-12">
                12 Apr 2006
            </time>
        </footer>
    </article>

    

    <article class="post">
        <header class="post-header">
            <h2 class="post-title"><a href="/writings/how-to-use-clientids-in-javascript-without-the-ugliness">How-to use ClientIDs in JavaScript without the ugliness</a></h2>
        </header>
        <section class="post-excerpt">
            <p>ASP.Net has an interesting way of handing the potential ID conflicts caused by embedding third-party controls within your web-page; it prefixes any sub-controls with their parent’s ID.</p>

<p><code class="highlighter-rouge">&lt;asp:TextBox ID="txtUsername" Runat="server" /&gt;</code> within a standard page simply has an ID of <code class="highlighter-rouge">txtUsername</code> within the HTML output. On the other hand, the following example would result in something along the lines of <code class="highlighter-rouge">_parent_txtUsername</code> as the ID:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"parent"</span> <span class="na">runat=</span><span class="s">"server"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;asp:TextBox</span> <span class="na">ID=</span><span class="s">"txtUsername"</span> <span class="na">Runat=</span><span class="s">"server"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre>
</div>

<p>This isn’t really much of a problem when all you are working with is server-side code, but when you start tinkering with JavaScript, things become quite annoying and get an overall feeling of hackiness.</p>

<p>One solution, which I have used time-and-again, is to use a script block at the end of your page where you create a series of variables that contain the actual IDs. You then use these variables to reach the actual elements via JavaScript.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;</span>
  <span class="kd">var</span> <span class="nx">txtUsernameID</span> <span class="o">=</span> <span class="s1">'&lt;%= txtUsername.ClientID %&gt;'</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">txtPasswordID</span> <span class="o">=</span> <span class="s1">'&lt;%= txtPassword.ClientID %&gt;'</span><span class="p">;</span>
<span class="nt">&lt;/script&gt;</span>
</code></pre>
</div>

<p>This solution works fine, but it isn’t exactly pretty and it doesn’t weigh well on my conscience.</p>

<h2 id="javascript-mapping">Javascript Mapping</h2>

<p>I’ve created a simple class that traverses the control structure and outputs an object that contains the mappings, as above, but without any client-side intervention; not a <code>&lt;%= ...ClientID %&gt;</code> in sight.</p>

<p>An example of the output would be:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">ClientIDs</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">txtUsername</span> <span class="o">=</span> <span class="s1">'ctrl0_txtUsername'</span><span class="p">,</span>
  <span class="nx">txtPassword</span> <span class="o">=</span> <span class="s1">'ctrl0_txtPassword'</span>
<span class="p">};</span>
</code></pre>
</div>

<p>Which enables you to reference elements, that you know are server-controls, by calling <code>ClientIDs.txtUsername</code>.</p>

<h3 id="before">Before:</h3>
<div class="highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;</span>
  <span class="kd">var</span> <span class="nx">txtUsernameID</span> <span class="o">=</span> <span class="s1">'&lt;%= txtUsername.ClientID %&gt;'</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">txtPasswordID</span> <span class="o">=</span> <span class="s1">'&lt;%= txtPassword.ClientID %&gt;'</span><span class="p">;</span>

  <span class="kd">function</span> <span class="nx">validate</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">username</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">txtUsernameID</span><span class="p">).</span><span class="nx">value</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">password</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">txtPasswordID</span><span class="p">).</span><span class="nx">value</span><span class="p">;</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="nx">username</span> <span class="o">==</span> <span class="s1">'james'</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">alert</span><span class="p">(</span><span class="s2">"you shouldn't be here!"</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="nt">&lt;/script&gt;</span>
</code></pre>
</div>

<h3 id="after">After:</h3>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;</span>
  <span class="kd">function</span> <span class="nx">validate</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">username</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">ClientIDs</span><span class="p">.</span><span class="nx">txtUsername</span><span class="p">).</span><span class="nx">value</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">password</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">ClientIDs</span><span class="p">.</span><span class="nx">txtPassword</span><span class="p">).</span><span class="nx">value</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">username</span> <span class="o">==</span> <span class="s1">'james'</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">alert</span><span class="p">(</span><span class="s2">"you shouldn't be here!"</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="nt">&lt;/script&gt;</span>
</code></pre>
</div>

<h2 id="servercontrolids-class">ServerControlIDs class</h2>

<h3 id="methods">Methods</h3>

<p><code>void Emit(page)</code> - Builds the controls of the page into a mapped structure, registering a client-side script block for the output.</p>

<p><code>void Emit(control, literal)</code> - Builds the controls of the control into a mapped structure, rendering the output into the literal control supplied. The literal is best suited to being placed into the <code>&lt;head&gt;</code> tag, which helps improve the semantic nature of your page.</p>

<h3 id="properties">Properties</h3>

<p><code>bool Whitespace</code> - Sets whether the output should contain whitespace, provided only for “prettifying” your code; defaults to off.</p>

<p><code>string VariableName</code> - Sets the JavaScript variable name used; defaults to ClientID.</p>

<h3 id="usage">Usage</h3>

<p>To use this class, simply create an instance in the PreRender event for your page — this ensures that all the controls have been set to their correct state — then call the Emit method you desire.</p>

<h2 id="history">History</h2>

<ul>
  <li>[1.1] Removed IDs from Repeater/DataGrid contained controls.</li>
  <li>[1.0] Initial release</li>
</ul>

<h2 id="download">Download</h2>

<p>That’s all there is to it, use the link below to get the latest version of ServerControlIDs.</p>

<p>Please note that this code isn’t pretty and it could probably do with some revising, but it works and that’s what’s important to me. I’m open to suggestions and feature requests.</p>

<p><a href="http://www.jagregory.com/downloads/ServerControlIDs-1.1.zip">Current Version (1.1)</a></p>

 <a class="read-more" href="/writings/how-to-use-clientids-in-javascript-without-the-ugliness">Read more &raquo;</a>
        </section>
        <footer class="post-meta">
            
            
            <time class="post-date" datetime="2006-04-12">
                12 Apr 2006
            </time>
        </footer>
    </article>

    

    <article class="post">
        <header class="post-header">
            <h2 class="post-title"><a href="/writings/hello-from-jagregorycom">Hello from JAGregory.com!</a></h2>
        </header>
        <section class="post-excerpt">
            <p>You should now be receiving this syndicated content from my new(ish) website <a href="http://www.jagregory.com">http://www.jagregory.com</a>. I’ve finally moved away from the .Text powered blogging system I’ve been using for the past few years in favour of Typo, a Ruby on Rails system.</p>

<p>I have a few reasons for doing this but the main one is that my blog as well as my personal website both validate to <acronym title="Extensible Hypertext Markup Language">XHTML</acronym> 1.0. On top of that, with the dynamic nature of Ruby on Rails, I can make changes to the layouts without having to recompile.</p>

<p>Please drop me a line if you spot anything out of place.</p>

<blockquote>
  <p>Future James: Isn’t this cute?</p>
</blockquote>

 <a class="read-more" href="/writings/hello-from-jagregorycom">Read more &raquo;</a>
        </section>
        <footer class="post-meta">
            
            
            <time class="post-date" datetime="2006-04-04">
                04 Apr 2006
            </time>
        </footer>
    </article>

    

    <article class="post">
        <header class="post-header">
            <h2 class="post-title"><a href="/writings/javascript-behaviour-amp-getelementsbyselector-mini-fix">JavaScript Behaviour & getElementsBySelector() mini-fix</a></h2>
        </header>
        <section class="post-excerpt">
            <p><a href="http://bennolan.com/behaviour/">Behaviour</a>, great bit of JavaScript!</p>

<p>While using it lately I came across a small bug in the code it’s based-on, <a href="http://simon.incutio.com/">Simon Willison</a>’s <a href="http://simon.incutio.com/archive/2003/03/25/getElementsBySelector">getElementsBySelector()</a>, when you use a selector that references an invalid ID paired with a tag name (e.g. <code>body#profile</code>, when <code>#profile</code> doesn’t exist), a script error occurs; yet using <code>#profile</code> alone works fine.</p>

<p>After a little bit of digging I found a solution, the source of the error is line 89:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="nx">tagName</span> <span class="o">&amp;&amp;</span> <span class="nx">element</span><span class="p">.</span><span class="nx">nodeName</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span> <span class="o">!=</span> <span class="nx">tagName</span><span class="p">)</span> <span class="p">{</span>
</code></pre>
</div>

<p>It’s finding the <code>tagName</code> (<code>body</code>), but element is undefined due to the ID being invalid. A slight change to the above if statement fixes the problem.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">element</span> <span class="o">||</span> <span class="p">(</span><span class="nx">tagName</span> <span class="o">&amp;&amp;</span> <span class="nx">element</span><span class="p">.</span><span class="nx">nodeName</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span> <span class="o">!=</span> <span class="nx">tagName</span><span class="p">))</span> <span class="p">{</span>
</code></pre>
</div>

<p>Maybe somebody will find that useful, I’ve posted it on Simons blog, but incase he doesn’t accept the change you can download the modified version here.</p>

<blockquote>
  <p>Note: If you’re using Behaviour, as opposed to just <code>getElementsBySelector()</code>, you’ll need to paste the contents of the above file into the bottom of your behaviour.js file, overwriting everything after the <code>Behaviour.start();</code> line.</p>
</blockquote>

 <a class="read-more" href="/writings/javascript-behaviour-amp-getelementsbyselector-mini-fix">Read more &raquo;</a>
        </section>
        <footer class="post-meta">
            
            
            <time class="post-date" datetime="2006-03-24">
                24 Mar 2006
            </time>
        </footer>
    </article>

    

    <article class="post">
        <header class="post-header">
            <h2 class="post-title"><a href="/writings/accessibility-for-uk-based-websites">Accessibility for UK based websites</a></h2>
        </header>
        <section class="post-excerpt">
            <p>As reported by <a href="http://news.bbc.co.uk/">BBC News</a>, a new set of <a href="http://news.bbc.co.uk/1/hi/technology/4783686.stm">accessibility guidelines</a> have been developed for UK websites.</p>

<p>Although this certainly isn’t anything new — being as a law was passed in 1999 for compliance — and it isn’t even legally binding, it may be used in court if a case arises. This is just one more little pebble added to the mounting landslide that will occur when a disabled user finally does the american thing and sues a company for not providing sufficient means to access their website.</p>

 <a class="read-more" href="/writings/accessibility-for-uk-based-websites">Read more &raquo;</a>
        </section>
        <footer class="post-meta">
            
            
            <time class="post-date" datetime="2006-03-08">
                08 Mar 2006
            </time>
        </footer>
    </article>

    

    <nav class="pagination" role="pagination">
    
        
            <a class="newer-posts" href="/page17/" title="Previous Page">&laquo; Newer Posts</a>
      
    
    <span class="page-number"> Page 18 of 23 </span>
     
        <a class="older-posts" href="/page19/" title="Next Page">Older Posts &raquo;</a>
     
</nav>

</main>

    <footer class="site-footer clearfix">
      <section class="copyright">
        <a href="mailto:james@jagregory.com">James Gregory</a> &copy;
               &bull; All content licensed under <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">cc by-nc-sa 4.0</a>.
      </section>
    </footer>

    <script type="text/javascript" src="/js/jquery-1.11.1.min.js"></script>
    <script type="text/javascript" src="/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="/js/index.js"></script>
</body>
</html>
