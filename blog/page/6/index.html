
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>James Gregory</title>
  <meta name="author" content="James Gregory">

  
  <meta name="description" content="A couple of people have already covered this already, specifically Bobby Johnson, Matt Hinze, and Zachariah Young. I figure I should say something on &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.jagregory.com/blog/page/6">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="James Gregory" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href='http://fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Cardo:regular,italic,bold,bolditalic' rel='stylesheet' type='text/css'>

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-3186192-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<logo>

<img src="/logo.png" alt="Website Logo. Upload to /source/logo.png ; disable in /source/_includes/logo.html" height="32px" width="32px">
</logo>



<body >
  <header role="banner"><hgroup>
  <h1><a href="/">James Gregory</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

<br>
  
<!--
<ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
-->

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/writings/introducing-fluent-nhibernate/">Introducing Fluent NHibernate</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-08-08T00:00:00+10:00" pubdate data-updated="true">Aug 8<span>th</span>, 2008</time>
        
           | <a href="/writings/introducing-fluent-nhibernate/#disqus_thread"
             data-disqus-identifier="http://www.jagregory.com/writings/introducing-fluent-nhibernate/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><blockquote><p>A couple of people have already covered this already, specifically <a href="http://www.IAmNotMyself.com/2008/08/07/SkinningTheCatWithFluentNHibernate.aspx">Bobby Johnson</a>, <a href="http://mhinze.com/fluent-nhibernate-project/">Matt Hinze</a>, and <a href="http://zachariahyoung.com/zy/post/2008/08/fluent-nhibernate-for-creating-entity-mapping-files.aspx">Zachariah Young</a>. I figure I should say something on it anyway.</p></blockquote>

<p>I&#8217;ve adopted a project from <a href="http://codebetter.com/blogs/jeremy.miller/">Jeremy Miller</a> that I think has the potential to be a really useful tool. It&#8217;s called <a href="http://www.fluentnhibernate.org">Fluent NHibernate</a>, and it&#8217;s primarily a fluent API for mapping classes with NHibernate.</p>

<p>We&#8217;re all well aware how awesome NHibernate is, but I think we all also have a bit of a dislike for the amount of XML you need to write to get your classes mapped; not only that, but also how the mappings are distinctly separate from the rest of your application. They&#8217;re often neglected and untested. One of the core tenets of the project is that we need a more succinct, readable, and testable way of writing your mappings.</p>

<h2>The API</h2>

<p>Take the following simple hbm file:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;</span>
</span><span class='line'><span class="nt">&lt;hibernate-mapping</span> <span class="na">xmlns=</span><span class="s">&quot;urn:nhibernate-mapping-2.2&quot;</span> <span class="na">namespace=</span><span class="s">&quot;Eg&quot;</span> <span class="na">assembly=</span><span class="s">&quot;Eg&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;class</span> <span class="na">name=</span><span class="s">&quot;Customer&quot;</span> <span class="na">table=</span><span class="s">&quot;Customers&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;id</span> <span class="na">name=</span><span class="s">&quot;ID&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;generator</span> <span class="na">class=</span><span class="s">&quot;identity&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/id&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;Name&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;Credit&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nt">&lt;bag</span> <span class="na">name=</span><span class="s">&quot;Products&quot;</span> <span class="na">table=</span><span class="s">&quot;Products&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;key</span> <span class="na">column=</span><span class="s">&quot;CustomerID&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>      <span class="nt">&lt;one-to-many</span> <span class="na">class=</span><span class="s">&quot;Eg.Product, Eg&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/bag&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nt">&lt;component</span> <span class="na">name=</span><span class="s">&quot;Address&quot;</span> <span class="na">class=</span><span class="s">&quot;Eg.Address, Eg&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;AddressLine1&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>      <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;AddressLine2&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>      <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;CityName&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>      <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;CountryName&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/component&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/class&gt;</span>
</span><span class='line'><span class="nt">&lt;/hibernate-mapping&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then compare it to the same mapping, created using the fluent API:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="n">CustomerMap</span> <span class="p">:</span> <span class="n">ClassMap</span><span class="p">&lt;</span><span class="n">Customer</span><span class="p">&gt;</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">public</span> <span class="nf">CustomerMap</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="n">Id</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">ID</span><span class="p">);</span>
</span><span class='line'>    <span class="n">Map</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Name</span><span class="p">);</span>
</span><span class='line'>    <span class="n">Map</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Credit</span><span class="p">);</span>
</span><span class='line'>    <span class="n">HasMany</span><span class="p">&lt;</span><span class="n">Product</span><span class="p">&gt;(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Products</span><span class="p">)</span>
</span><span class='line'>      <span class="p">.</span><span class="n">AsBag</span><span class="p">();</span>
</span><span class='line'>    <span class="n">Component</span><span class="p">&lt;</span><span class="n">Address</span><span class="p">&gt;(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Address</span><span class="p">,</span> <span class="n">m</span> <span class="p">=&gt;</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">m</span><span class="p">.</span><span class="n">Map</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">AddressLine1</span><span class="p">);</span>
</span><span class='line'>        <span class="n">m</span><span class="p">.</span><span class="n">Map</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">AddressLine2</span><span class="p">);</span>
</span><span class='line'>        <span class="n">m</span><span class="p">.</span><span class="n">Map</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">CityName</span><span class="p">);</span>
</span><span class='line'>        <span class="n">m</span><span class="p">.</span><span class="n">Map</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">CountryName</span><span class="p">);</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Firstly, you&#8217;ll note that there is a marginal reduction in lines of code, but that&#8217;s not what we&#8217;re particularly striving for. Instead we&#8217;re intent on reducing the verbosity and <strong>noise</strong> of the code. This manifests itself in a <a href="http://en.wikipedia.org/wiki/Convention_over_Configuration">convention over configuration</a> design for the API, where we choose the most common setups and use those as the default. For example with the <code>id</code> element in the hbm file, you&#8217;re required to specify what the generator type is; however, in our fluent API we check the type of your identity property and decide what generator we should use. Int&#8217;s and longs default to identity, while GUIDs use the guid.comb generator. You can change these explicitly, but when you are using the default, it greatly reduces the verbosity of your mapping.</p>

<h2>Testability</h2>

<p>Another one of our goals is to make your mappings more robust. I imagine most people have had the problem where you&#8217;ve renamed a property and not updated the mapping file; due to there being no compile time validation, the only way to catch these mistakes are at run time (hopefully you had tests to cover that!). With the way our API is designed, you use the actual properties on your classes to create the mapping, so there&#8217;s nothing to forget. If you rename a property, your IDE will either rename the property in the mapping, or fail at compilation.</p>

<p>We also want to help you verify that your mappings are set up properly, not just syntactically valid. So to make your   integration tests a bit easier, we&#8217;re providing an API for testing your mappings.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="na">[Test]</span>
</span><span class='line'><span class="k">public</span> <span class="k">void</span> <span class="nf">VerifyCustomerSaves</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">new</span> <span class="n">PersistenceSpecification</span><span class="p">&lt;</span><span class="n">Customer</span><span class="p">&gt;()</span>
</span><span class='line'>        <span class="p">.</span><span class="n">CheckProperty</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span> <span class="s">&quot;James Gregory&quot;</span><span class="p">)</span>
</span><span class='line'>        <span class="p">.</span><span class="n">CheckProperty</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Age</span><span class="p">,</span> <span class="m">22</span><span class="p">)</span>
</span><span class='line'>        <span class="p">.</span><span class="n">VerifyTheMappings</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Behind the scenes the <code>PersistenceSpecification</code> creates an instance of your entity, then populates it with the values you specify through the <code>CheckProperty</code> method. This entity is then saved to the database, then reloaded through a separate connection. The returned entity is then compared to the one originally saved, and any differences fail the test. It&#8217;s a fairly standard integration test, except we&#8217;ve taken the time to write all the wiring up that needs to be done, so you don&#8217;t have to.</p>

<h2>The Framework</h2>

<p>We&#8217;re working towards our first official release, which will have a fairly solid implementation of the API. Once that&#8217;s out in the wild, we&#8217;re going to focus on our Framework.</p>

<p>Our framework is a layer that sits on-top of the API to provide an even better experience. We&#8217;re looking to integrate with your favorite container, which will reduce the code you need to write to integrate NHibernate into your system. Then we&#8217;re going to tackle extensible conventions, which will allow you to specify your own implied conventions for your application. For example, if you&#8217;re <strong>always</strong> going to call your identifier &#8220;ID&#8221;, then why should you have to specify it every time? <em>You shouldn&#8217;t!</em></p>

<p>Development is progressing at a nice pace, and I expect we&#8217;ll be able to get our first release out within the next few weeks. The testing API hasn&#8217;t been kept quite as up to date as the main API, but we&#8217;re working on that too. It&#8217;s open-source, so suggestions and patches are welcome.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/writings/latest-on-boolangstudio/">Latest on BooLangStudio</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-08-07T00:00:00+10:00" pubdate data-updated="true">Aug 7<span>th</span>, 2008</time>
        
           | <a href="/writings/latest-on-boolangstudio/#disqus_thread"
             data-disqus-identifier="http://www.jagregory.com/writings/latest-on-boolangstudio/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>It&#8217;s been a long time since I&#8217;ve written anything about <a href="http://www.codeplex.com/BooLangStudio">BooLangStudio</a>. Let me assure you that the development is still very much underway, and we&#8217;re steadily working towards our first release.</p>

<p>To fill you in a bit on what&#8217;s been going on. Jeffery Olson has completely rewritten the syntax highlighting to use the more flexible Boo.Pegs lexer, which allows us to overcome some of the obstacles we were facing with the traditional Boo lexer. There were limitations to what we could do with the traditional lexer, without modifying the Boo source. This was leading us down a road we weren&#8217;t keen on, one of maintaining a fork of the Boo source that contained our specific changes. With the move to the Boo.Pegs lexer, we&#8217;re free of this scenario!</p>

<p><img src="/images/bls-1.png" alt="Syntax highlighting" /></p>

<p><a href="http://www.justnbusiness.com/">Justin Chase</a> has been tackling various issues all over the place. Several related to the build process, specifically how the Boo binaries are located on your machine, which has been a bit of a problem when there&#8217;s multiple developers working on a project whom both have Boo installed in a different location. He&#8217;s also been spiffing up the interface by adding some much needed icons to the projects.</p>

<p><img src="/images/bls-2.png" alt="Project view" /></p>

<p><a href="http://www.codinginstinct.com/">Torkel Ödegaard</a> has been working various issues throughout the project. He&#8217;s created a properties dialog for the project which allows you to alter the usual settings for your project, assembly name, default namespace etc&#8230; He also managed to get debugging working, which is awesome.</p>

<p>Then there&#8217;s me, I&#8217;ve been working on the intellisense capabilities. We&#8217;ve had intellisense support from day one, but it&#8217;s never been very extensive. For a long time it only worked on the current file you had open.</p>

<p>The entire solution is now processed behind-the-scenes to provide intellisense. Import statements are now recognised and imported types appear in the local scope intellisense. Any assemblies or projects that are referenced have their top-level types and namespaces included in the intellisense too.</p>

<p>Additionally I&#8217;ve been working on improving the method suggestion logic, which was initially very flakey. It boils down to being able to transform the current line into the desired type, which can be difficult in certain cases (<code>StringBuilder().Append("Hello world").ToString().</code> for example).</p>

<p><img src="/images/bls-3.png" alt="Code completion" /></p>

<p>I believe that about covers what we&#8217;ve been upto lately. Our biggest problem currently is that most of these features are implemented in separate branches, and haven&#8217;t yet been merged into our central repository. We&#8217;re working on this, and I reckon once we&#8217;ve done that we&#8217;ll be looking at doing a release.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/writings/missed-out-on-something-big/">Missed Out on Something Big</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-07-01T00:00:00+10:00" pubdate data-updated="true">Jul 1<span>st</span>, 2008</time>
        
           | <a href="/writings/missed-out-on-something-big/#disqus_thread"
             data-disqus-identifier="http://www.jagregory.com/writings/missed-out-on-something-big/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Ever get the feeling that you&#8217;ve missed out on something big? I never got to see Star Wars at the cinema. I missed out on the start of computers, the ASM, the BASIC hacking and what-not. I discovered most of my musical taste way after the bands were gone or going, so I never got to see them in show.</p>

<p>None of those are my fault, of course, because they were all before my time; in fact, most were at least a decade before me. That still doesn&#8217;t stop me from ocasionally getting the feeling that I missed out on something big.</p>

<p>One more. One that&#8217;s pertient to our industry: Smalltalk.</p>

<p>Smalltalk is one of those languages, possibly the most prominent example, that has been idolised over time. It&#8217;s often touted as having an excellent programmer experience, properly object-oriented, the source of refactoring, great tools, and a solid virtual machine behind it. It&#8217;s one of those languages that people are proud to say they once worked with it. A language that people nosalgicly look back on. It&#8217;s also got an air of betamax about it (yeah, I missed that one too), people were sure it was better, but it still didn&#8217;t become mainstream.</p>

<blockquote><p>&#8220;We Smalltalkers used to think the advantages of our language were so significant that it would take over the world. We had a huge productivity advantage over C coders. Then C++ came along and gave C coders just enough to let them improve their productivity and their ability to write larger more complex systems. It still wasn’t as good as Smalltalk, but it was better than C, and much more accessible to most programmers than Smalltalk.&#8221; - <a href="http://blog.hasmanythrough.com/2008/5/31/quick-railsconf-update">Josh Susser</a> via <a href="http://weblog.raganwald.com/2008/06/bit-of-history-and-interesting.html">Raganwald</a></p></blockquote>

<p>So where am I going with this? Just like I can make myself feel a bit better by watching Star Wars on a large TV, or listening to the Rolling Stones live albums. I&#8217;d like to see what all the fuss was about with Smalltalk, by giving it a go.</p>

<p>I&#8217;m not sure where to start on this, or how long it&#8217;s going to take, or even when I&#8217;m going to do it; however, one day in the not too distant future I&#8217;m going to do some programming with Smalltalk.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/writings/boo-visual-studio-plugin-progress/">Boo Visual Studio Plugin Progress</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-05-25T00:00:00+10:00" pubdate data-updated="true">May 25<span>th</span>, 2008</time>
        
           | <a href="/writings/boo-visual-studio-plugin-progress/#disqus_thread"
             data-disqus-identifier="http://www.jagregory.com/writings/boo-visual-studio-plugin-progress/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Quick update on the <a href="/writings/boo-visual-studio-plug-in-1-complete/">Boo plugin I mentioned previously</a>. Jeff Olson announced the <a href="http://www.codeplex.com/BooLangStudio">BooLangStudio</a> project a couple of days after I announced mine, and we&#8217;ve decided to join forces. I&#8217;ve begun merging our codebases, and we&#8217;re looking to get a release out in the not too distant future.</p>

<p>Our combined code-bases have now got syntax highlighting, intellisense, single file and project support. Not bad going.</p>

<p>We&#8217;ve now got a nice little team going as well, which is a big improvement from what was the one man band of my self. One of the contributors, <a href="http://www.codinginstinct.com/2008/05/boo-in-visual-studio.html">Torkel Ödegaard</a>, has written a <a href="http://www.codinginstinct.com/2008/05/boo-in-visual-studio.html">nice overview</a> of our progress and processes as-well.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/writings/freeing-the-model-from-its-evil-web-service-oppressors/">Freeing the Model From Its Evil Web-service Oppressors</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-05-18T00:00:00+10:00" pubdate data-updated="true">May 18<span>th</span>, 2008</time>
        
           | <a href="/writings/freeing-the-model-from-its-evil-web-service-oppressors/#disqus_thread"
             data-disqus-identifier="http://www.jagregory.com/writings/freeing-the-model-from-its-evil-web-service-oppressors/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>The current system I&#8217;m working with has a setup whereby the model (data access objects) are being used by the web-services for delivery; this means that the consumers of the web-services are directly tied to our inner implementation of our data access code. On-top of that, it&#8217;s old full of bad conventions, and is in need of refactoring.</p>

<p>This is my account of how I freed the model from the web-service.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">vehicle_info</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="kt">int</span> <span class="n">vehicle_id</span><span class="p">;</span>
</span><span class='line'>    <span class="k">public</span> <span class="kt">string</span> <span class="n">vehicle_name</span><span class="p">;</span>
</span><span class='line'>    <span class="k">public</span> <span class="kt">string</span> <span class="n">vehicle_manufacturer</span><span class="p">;</span>
</span><span class='line'>    <span class="k">public</span> <span class="n">DateTime</span> <span class="n">vehicle_manufactured_date</span><span class="p">;</span>
</span><span class='line'>    <span class="k">public</span> <span class="kt">int</span> <span class="n">vehicle_number_produced</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>That&#8217;s the existing model. You can see that these have some nasty naming conventions that I just can&#8217;t live with anymore.</p>

<p>A large problem with pushing your model out to the web-service consumers is that I can&#8217;t refactor the classes without breaking their implementations; if I rename a field in my model, the consumers will have to update their code to deal with it. This is an issue because not all the consumers are able to update their code. So we&#8217;re stuck with how the classes were built years ago, with awful naming conventions, and no ability to change.</p>

<p>What&#8217;s the ideal setup then? It&#8217;s my opinion that we should be using specialised DTOs (Data Transfer Objects) for this purpose, they&#8217;ll exist solely to be the transport mechanism for the web-service. With DTOs you&#8217;re separating what your service pushes out from what you use internally, which allows you to refactor your internal design without any problems with integration.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">VehicleWebServiceDto</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="kt">int</span> <span class="n">vehicle_id</span><span class="p">;</span>
</span><span class='line'>    <span class="k">public</span> <span class="kt">string</span> <span class="n">vehicle_name</span><span class="p">;</span>
</span><span class='line'>    <span class="k">public</span> <span class="kt">string</span> <span class="n">vehicle_manufacturer</span><span class="p">;</span>
</span><span class='line'>    <span class="k">public</span> <span class="n">DateTime</span> <span class="n">vehicle_manufactured_date</span><span class="p">;</span>
</span><span class='line'>    <span class="k">public</span> <span class="kt">int</span> <span class="n">vehicle_number_produced</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>There&#8217;s an issue with using DTOs in an existing web-service environment, it&#8217;s unlikely your DTOs will be named the same as your original objects (if they do, you&#8217;re fine). We can&#8217;t just swap it out with a DTO, because the signatures won&#8217;t match in the WSDL.</p>

<p>When we change the web-service to return those DTOs instead of the original classes, we end up with this mismatch in the output:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;vehicle_info&gt;</span>
</span><span class='line'>  <span class="nt">&lt;vehicle_id&gt;</span>int<span class="nt">&lt;/vehicle_id&gt;</span>
</span><span class='line'>  <span class="nt">&lt;vehicle_name&gt;</span>string<span class="nt">&lt;/vehicle_name&gt;</span>
</span><span class='line'>  ...
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;VehicleWebServiceDto&gt;</span>
</span><span class='line'>  <span class="nt">&lt;vehicle_id&gt;</span>int<span class="nt">&lt;/vehicle_id&gt;</span>
</span><span class='line'>  <span class="nt">&lt;vehicle_name&gt;</span>string<span class="nt">&lt;/vehicle_name&gt;</span>
</span><span class='line'>  ...
</span></code></pre></td></tr></table></div></figure>


<p>How can we get around this? Make the signatures match.</p>

<p>You can control the way objects are serialized by the web-service through the serialization attributes; namely the <code>XmlRoot</code> and <code>SoapType</code> attributes are the ones you&#8217;re looking for, these allow you to override what name is output in the xml for your class. Slap on those attributes, one for the standard HTTP usage and the other for SOAP, and give them your old class name; then as far as the consumers of the webservice can see, you&#8217;re giving them the same old classes. Now you have a separate DTO from your domain layer, but without breaking the schema.</p>

<p>These are the updated DTO objects:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="na">[XmlRoot(&quot;vehicle_info&quot;), SoapType(&quot;vehicle_info&quot;)]</span>
</span><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">VehicleWebServiceDto</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="kt">int</span> <span class="n">vehicle_id</span><span class="p">;</span>
</span><span class='line'>    <span class="k">public</span> <span class="kt">string</span> <span class="n">vehicle_name</span><span class="p">;</span>
</span><span class='line'>    <span class="k">public</span> <span class="kt">string</span> <span class="n">vehicle_manufacturer</span><span class="p">;</span>
</span><span class='line'>    <span class="k">public</span> <span class="n">DateTime</span> <span class="n">vehicle_manufactured_date</span><span class="p">;</span>
</span><span class='line'>    <span class="k">public</span> <span class="kt">int</span> <span class="n">vehicle_number_produced</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Which now produce this xml:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;vehicle_info&gt;</span>
</span><span class='line'>  <span class="nt">&lt;vehicle_id&gt;</span>int<span class="nt">&lt;/vehicle_id&gt;</span>
</span><span class='line'>  <span class="nt">&lt;vehicle_name&gt;</span>string<span class="nt">&lt;/vehicle_name&gt;</span>
</span><span class='line'>  ...
</span></code></pre></td></tr></table></div></figure>


<p>We are now free to refactor our code as much as we like, without affecting the output of the web-service.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">Vehicle</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="kt">int</span> <span class="n">ID</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>    <span class="k">public</span> <span class="kt">string</span> <span class="n">Name</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>    <span class="k">public</span> <span class="n">ManufacturingDetails</span> <span class="n">ManufacturingDetails</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">ManufacturingDetails</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="n">Manufacturer</span> <span class="n">Manufacturer</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>    <span class="k">public</span> <span class="n">DateTime</span> <span class="n">ManufacturedDate</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>    <span class="k">public</span> <span class="kt">int</span> <span class="n">NumberProduced</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">Manufacturer</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="kt">int</span> <span class="n">ID</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>    <span class="k">public</span> <span class="kt">string</span> <span class="n">Name</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Magic.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/writings/boo-visual-studio-plug-in-1-complete/">Boo Visual Studio Plug-in: 1% Complete</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-05-18T00:00:00+10:00" pubdate data-updated="true">May 18<span>th</span>, 2008</time>
        
           | <a href="/writings/boo-visual-studio-plug-in-1-complete/#disqus_thread"
             data-disqus-identifier="http://www.jagregory.com/writings/boo-visual-studio-plug-in-1-complete/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>What do we want? <em>A Boo plug-in for Visual Studio</em>. When do we want it? <em>Sooner, rather than later</em>.</p>

<p>The initial aim of this plug-in is to provide a &#8220;good enough&#8221; experience when using Boo files within other projects. I&#8217;m not currently focussing on doing full-scale development with Boo; so the target is DSLs and Binsor. There won&#8217;t be any assemblies created, or anything else that would affect your project. The only difference between how you work now would be that you could write Boo using Visual Studio, with syntax highlighting and intellisense.</p>

<p>That&#8217;s for the initial version anyway.</p>

<p>I&#8217;ve found that creating a plugin for Visual Studio isn&#8217;t that difficult, in-fact that&#8217;s an understatement, it&#8217;s stupidly easy. Most of the plugin architecture is successfully created using the project wizard, so there&#8217;s very little I needed to do from that point of view. The tricky part is getting Boo and Visual Studio to communicate.</p>

<p>I started by spending some time looking at the IronPython Studio implementation, the Boo implementation, abstract syntax trees, antlr, and after getting my head around what I needed to do, I set out on my adventure.</p>

<p>So what&#8217;s the result? A very basic (and flakey) implementation of both syntax highlighting and intellisense.</p>

<p><img src="/images/booplugin-syntax.jpg" alt="Boo Plugin syntax highlighting" /></p>

<p>The highlighter isn&#8217;t perfect yet. It suffers from slowdown when you&#8217;re writing an unclosed string, and it can&#8217;t handle multi-line statements yet (think comment blocks).</p>

<p><img src="/images/booplugin-codecomplete.jpg" alt="Boo Plugin code completion" /></p>

<p>The intellisense is pretty basic, it allows namespace navigation, and type methods, but there isn&#8217;t much in the way of constraints (you can see instance methods against types, for example).</p>

<p>There&#8217;s a lot of work to be done, but it&#8217;s fun and interesting.</p>

<h2>Targets</h2>

<p>In the near future I&#8217;d like to get the following done:</p>

<ul>
  <li>Make intellisense work with everything in the local scope</li>
  <li>Make intellisense parse import statements</li>
  <li>Make syntax-highlighting correctly handle multi-line blocks</li>
  <li>Make syntax-highlighting highlight types (like C# does)</li>
</ul>


<p>Then at some point tackle these:</p>

<ul>
  <li>Get Resharper involved</li>
  <li>Refactoring support</li>
</ul>


<p>Hopefully I&#8217;ll progress on these and report back in a future post.</p>

<h1>Code</h1>

<p>The code is poor, it&#8217;s a mess and probably all wrong; however, you can get it in the usual place. However, I haven&#8217;t provided a direct download because it isn&#8217;t really in a state to be distributed yet.</p>

<p>The source is accessible from Subversion at: http://jagregory.googlecode.com/svn/trunk/BooPlugin/ (using user jagregory-read-only)</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/writings/plugin-baby-steps/">Plugin Baby Steps</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-05-12T00:00:00+10:00" pubdate data-updated="true">May 12<span>th</span>, 2008</time>
        
           | <a href="/writings/plugin-baby-steps/#disqus_thread"
             data-disqus-identifier="http://www.jagregory.com/writings/plugin-baby-steps/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Making a Visual Studio 2008 plugin isn&#8217;t as hard as it sounds.</p>

<p>Making one that works is a bit more difficult.</p>

<p>Syntax highlighting is fairly straight forward, just run a tokenizer over the text and colour code each token appropriately. It&#8217;s the code sense that is causing me to go slightly mad. To determine what methods need to be listed when the intellisesne pops up, you need to parse the code that&#8217;s in the document, then resolve any classes and references in there to build up a collection of methods to display. It gets more tricky when the document isn&#8217;t valid, because you can&#8217;t compile it. That&#8217;s where I am now, I need to figure out some way of partially compiling the document, or maybe using an AST walker.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/writings/futility-transforming-entities-into-dtos/">Futility: Transforming Entities Into DTOs</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-05-06T00:00:00+10:00" pubdate data-updated="true">May 6<span>th</span>, 2008</time>
        
           | <a href="/writings/futility-transforming-entities-into-dtos/#disqus_thread"
             data-disqus-identifier="http://www.jagregory.com/writings/futility-transforming-entities-into-dtos/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><blockquote><p>Future James: This is pretty much describing <a href="http://automapper.codeplex.com/">AutoMapper</a>, just take a look at that instead.</p></blockquote>

<p>I quite dislike mapping DTOs to entities, it&#8217;s a pain, but mostly tedious and tiresome rather than difficult. I decided to try to ease things by creating a library that would resolve entity instances to their DTO counterparts.</p>

<p>My requirements were few but I was determined not to violate any of them.</p>

<ol>
  <li>Refactoring friendly. No strings for property names, changing names should give compiler errors.</li>
  <li>Must simplify code.</li>
  <li>Must improve maintainability.</li>
</ol>


<h2>First attempt: Explicit mapping</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="n">var</span> <span class="n">mapper</span> <span class="p">=</span> <span class="k">new</span> <span class="n">DtoMapper</span><span class="p">&lt;</span><span class="n">Customer</span><span class="p">,</span> <span class="n">CustomerDto</span><span class="p">&gt;();</span>
</span><span class='line'>
</span><span class='line'><span class="n">mapper</span><span class="p">.</span><span class="n">Pair</span><span class="p">(</span><span class="n">mapper</span><span class="p">.</span><span class="n">Entity</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span> <span class="n">mapper</span><span class="p">.</span><span class="n">Dto</span><span class="p">.</span><span class="n">CustomerName</span><span class="p">);</span>
</span><span class='line'><span class="n">mapper</span><span class="p">.</span><span class="n">Pair</span><span class="p">(</span><span class="n">mapper</span><span class="p">.</span><span class="n">Entity</span><span class="p">.</span><span class="n">Address</span><span class="p">,</span> <span class="n">mapper</span><span class="p">.</span><span class="n">Dto</span><span class="p">.</span><span class="n">CustomerAddress</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// ... elsewhere ...</span>
</span><span class='line'>
</span><span class='line'><span class="n">CustomerDto</span> <span class="n">dto</span> <span class="p">=</span> <span class="n">mapper</span><span class="p">.</span><span class="n">Transform</span><span class="p">(</span><span class="n">customer</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>With a clever bit of DynamicProxy usage, this implementation successfully mapped properties on an entity to a DTO. I believed it was reasonably clear, but having to use mapper.Entity was a bit obtuse. Dealing with properties on instances without an instance is tricky, especially if you want to avoid using strings.</p>

<p>The explicit mapping is very refactoring friendly. I could rename a property without breaking the mapping, so requirement 1 was satisfied.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="n">var</span> <span class="n">dto</span> <span class="p">=</span> <span class="k">new</span> <span class="n">CustomerDto</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'><span class="n">dto</span><span class="p">.</span><span class="n">CustomerName</span> <span class="p">=</span> <span class="n">customer</span><span class="p">.</span><span class="n">Name</span><span class="p">;</span>
</span><span class='line'><span class="n">dto</span><span class="p">.</span><span class="n">CustomerAddress</span> <span class="p">=</span> <span class="n">customer</span><span class="p">.</span><span class="n">Address</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">return</span> <span class="n">dto</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>As the above code demonstrates, this implementation isn&#8217;t actually any simpler than just doing simple assignments, it&#8217;s in-fact more complicated because of the overhead of understanding what the mapper is. This simple assignment method is also refactoring friendly.</p>

<p>So with requirement 2 failed, and requirement 3 no different to doing it manually, it was time to move on.</p>

<h2>Second attempt: Implicit mapping</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="n">var</span> <span class="n">mapper</span> <span class="p">=</span> <span class="k">new</span> <span class="n">DtoMapper</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'><span class="n">mapper</span><span class="p">.</span><span class="n">CreateImplicitMap</span><span class="p">&lt;</span><span class="n">Customer</span><span class="p">,</span> <span class="n">CustomerDto</span><span class="p">&gt;();</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// ... elsewhere ...</span>
</span><span class='line'>
</span><span class='line'><span class="n">CustomerDto</span> <span class="n">dto</span> <span class="p">=</span> <span class="n">mapper</span><span class="p">.</span><span class="n">Transform</span><span class="p">(</span><span class="n">customer</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is my favourite implementation, it&#8217;s clean and smart; however, it&#8217;s also useless.</p>

<p>It did the same as the first example, but implicitly mapped any properties that have the same name together. This is fine, but it would ignore anything that don&#8217;t have the same names. I could&#8217;ve implemented some logic for guessing names, but that would just be asking for trouble.</p>

<p>Tragically this implementation wasn&#8217;t that refactoring friendly; you can rename properties, but it would silently stop mapping them unless you renamed it&#8217;s partner too. That&#8217;s pretty dangerous stuff. Requirement 1 failed.</p>

<p>It does produce less code than the first implementation, and the simple assignment method, so 2 and 3 are covered.</p>

<h2>Third attempt: Attributes</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">CustomerDto</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'><span class="na">  [DtoPartner(typeof(Customer), &quot;Name&quot;)]</span>
</span><span class='line'>  <span class="k">public</span> <span class="kt">string</span> <span class="n">CustomerName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'><span class="na">  </span>
</span><span class='line'><span class="na">  [DtoPartner(typeof(Customer), &quot;Address&quot;)]</span>
</span><span class='line'>  <span class="k">public</span> <span class="kt">string</span> <span class="n">CustomerAddress</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>I could live with this implementation, it&#8217;s not as clean as the implicit method, but it is still quite clear.</p>

<p>Unfortunately, it fails in the refactoring test. You can&#8217;t rename a property on Customer without it breaking the mapping, because the property names are strings. Requirement 1 failed.</p>

<p>You could smooth over this with an inspection unit test, which checks the strings against their types to see if the property exists, but that smells, it&#8217;s not a very good library if you have to verify it even works. I could&#8217;ve also created a static class to represent the Customer instance properties, but that&#8217;s more noise (you&#8217;d need 3 classes, instead of just 2); a pre-build step (ala SubSonic) came to mind, but that&#8217;s entering into the realm of diminished returns.</p>

<h2>Conclusion?</h2>

<p>Sometimes the obvious way is the best way. Old fashioned may be old, but that doesn&#8217;t make it wrong. Sometimes a cigar is just a cigar.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/writings/all-about-dependencies/">All About Dependencies</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-04-05T00:00:00+11:00" pubdate data-updated="true">Apr 5<span>th</span>, 2008</time>
        
           | <a href="/writings/all-about-dependencies/#disqus_thread"
             data-disqus-identifier="http://www.jagregory.com/writings/all-about-dependencies/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><blockquote><p>This article serves as an introduction to the concept of <a href="http://martinfowler.com/articles/injection.html">Dependency Injection</a>, and why you&#8217;d want to use it. It is not a getting started guide for using containers. If you&#8217;re interested in those, my personal preference is <a href="http://www.castleproject.org/container/">Castle Windsor</a> and you can find their <a href="http://www.castleproject.org/container/gettingstarted/index.html">getting started guide here</a>.</p></blockquote>

<p>What are dependencies? Also referred to as couplings, dependencies are other modules that one module requires to fulfil it&#8217;s purpose.</p>

<p>Are dependencies bad? No, of course they&#8217;re not, otherwise we wouldn&#8217;t be able to create anything. However, highly coupled code can cause a lot of problems for your application.</p>

<p>If your code requires knowledge of how a dependency works, then your code is highly coupled. If your code is tied explicitly to an implementation, then your code is also highly coupled.</p>

<p>Take the following example:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">ProductUpdater</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">public</span> <span class="k">void</span> <span class="nf">StoreChanges</span><span class="p">(</span><span class="n">Product</span> <span class="n">product</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="n">SqlDataStore</span> <span class="n">dataStore</span> <span class="p">=</span> <span class="k">new</span> <span class="n">SqlDataStore</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">dataStore</span><span class="p">.</span><span class="n">CreateConnection</span><span class="p">();</span>
</span><span class='line'>    <span class="n">dataStore</span><span class="p">.</span><span class="n">OpenConnection</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">dataStore</span><span class="p">.</span><span class="n">Update</span><span class="p">(</span><span class="n">product</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">dataStore</span><span class="p">.</span><span class="n">CloseConnection</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The above example is highly coupled to the <code>SqlDataStore</code>. Firstly, it directly creates an instance, which means there&#8217;s no way for us to replace that instance if we need to (I&#8217;ll come to why you&#8217;d want to do that in a bit). Secondly, it relies on a great deal of knowledge of <code>SqlDataStore</code>&#8217;s implementation. In this code we can see that you need to create a connection and open it before you can update the record; that&#8217;s quite a bit of implementation knowledge. If the <code>SqlDataStore</code> was to change so that the <code>OpenConnection</code> method created a connection if one didn&#8217;t already exist, then we&#8217;d need to change every caller of  that code to remove the <code>CreateConnection</code> call; in large system situations like that can quickly lead to a fear of change and refactoring.</p>

<p>I mentioned directly creating an instance stops us from replacing it if need be.  Well when would you actually want to do this? For those unfamiliar with unit testing, you probably haven&#8217;t encountered <a href="http://www.martinfowler.com/bliki/TestDouble.html">test doubles</a>; there are different types of test doubles, but for the purposes of this example they&#8217;re interchangeable.</p>

<p>A test double serves as a swap-in replacement for one of your dependencies. These allow you to execute a piece of code under test, without having to worry about whether things are being put in your database, or e-mails sent for example. If your code is creating instances within methods, those instances cannot be replaced by a test double. Without that ability, testing becomes considerably more difficult.</p>

<p>Tightly tying your code to an instance of a class reduces the flexibility and reuse of your code. Take the above example, that same code could be used to update the product in a cache instead of the database; similarly, you could use an in-memory storage instead of a database for when you&#8217;re running in a test or demo environment. If only your method wasn&#8217;t so tightly tied to the implementation.</p>

<p>This is solved by using <a href="http://martinfowler.com/articles/injection.html">Dependency Injection</a>, which is a part of the <a href="http://en.wikipedia.org/wiki/Dependency_inversion_principle"Dependency Inversion Principal</a> and <a href="http://en.wikipedia.org/wiki/Inversion_of_Control">Inversion of Control</a>.</p>

<blockquote><p>[DIP] seeks to &#8220;invert&#8221; the conventional notion that high level modules in software should depend upon the lower level modules. The principle states that high level or low level modules should not depend upon each other, instead they should depend upon abstractions. &#8211; Wikipedia</p></blockquote>

<p>Essentially, dependency injection allows you to stop instantiating your dependencies. Instead they&#8217;re &#8220;injected&#8221; into your object when it is instantiated itself. This allows the dependencies to be swapped out like we mentioned above.</p>

<p>So taking the original example, here&#8217;s a version of it that&#8217;s been updated to use dependency injection.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">ProductUpdater</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">private</span> <span class="n">SqlDataStore</span> <span class="n">dataStore</span><span class="p">;</span>
</span><span class='line'>  
</span><span class='line'>  <span class="k">public</span> <span class="nf">ProductUpdater</span><span class="p">(</span><span class="n">SqlDataStore</span> <span class="n">dataStore</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="n">dataStore</span> <span class="p">=</span> <span class="n">dataStore</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  
</span><span class='line'>  <span class="k">public</span> <span class="k">void</span> <span class="nf">StoreChanges</span><span class="p">(</span><span class="n">Product</span> <span class="n">product</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="n">dataStore</span><span class="p">.</span><span class="n">CreateConnection</span><span class="p">();</span>
</span><span class='line'>    <span class="n">dataStore</span><span class="p">.</span><span class="n">OpenConnection</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">dataStore</span><span class="p">.</span><span class="n">Update</span><span class="p">(</span><span class="n">product</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">dataStore</span><span class="p">.</span><span class="n">CloseConnection</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The above implementation now allows us to create a test double, and replace the <code>SqlDataStore</code> in our tests. As I mentioned before, we could now easily push in an in-memory implementation without any changes to the code required.</p>

<p>We can take this further though, because we&#8217;re still tied to a concrete class. Lets make <code>SqlDataStore</code> implement an interface, so we can create other implementations.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">interface</span> <span class="n">IDataStore</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">void</span> <span class="nf">CreateConnection</span><span class="p">();</span>
</span><span class='line'>  <span class="k">void</span> <span class="nf">OpenConnection</span><span class="p">();</span>
</span><span class='line'>  <span class="k">void</span> <span class="nf">Update</span><span class="p">(</span><span class="n">Product</span> <span class="n">product</span><span class="p">);</span>
</span><span class='line'>  <span class="k">void</span> <span class="nf">CloseConnection</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">ProductUpdater</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">private</span> <span class="n">IDataStore</span> <span class="n">dataStore</span><span class="p">;</span>
</span><span class='line'>  
</span><span class='line'>  <span class="k">public</span> <span class="nf">ProductUpdater</span><span class="p">(</span><span class="n">IDataStore</span> <span class="n">dataStore</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="n">dataStore</span> <span class="p">=</span> <span class="n">dataStore</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  
</span><span class='line'>  <span class="k">public</span> <span class="k">void</span> <span class="nf">StoreChanges</span><span class="p">(</span><span class="n">Product</span> <span class="n">product</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="n">dataStore</span><span class="p">.</span><span class="n">CreateConnection</span><span class="p">();</span>
</span><span class='line'>    <span class="n">dataStore</span><span class="p">.</span><span class="n">OpenConnection</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">dataStore</span><span class="p">.</span><span class="n">Update</span><span class="p">(</span><span class="n">product</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">dataStore</span><span class="p">.</span><span class="n">CloseConnection</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now our example is no longer specifically tied to a <code>SqlDataStore</code>, so we could quite easily pass it a <code>FileSystemDataStore</code>, or an <code>InMemoryDataStore</code>, or anything else that implements <code>IDataStore</code>. All that without having to touch a single line within the <code>ProductUpdater</code>.</p>

<p>That&#8217;s the power of dependency injection, and why you should stop hard-coding your dependencies.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/writings/static-method-abuse/">Static Method Abuse</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-03-28T00:00:00+11:00" pubdate data-updated="true">Mar 28<span>th</span>, 2008</time>
        
           | <a href="/writings/static-method-abuse/#disqus_thread"
             data-disqus-identifier="http://www.jagregory.com/writings/static-method-abuse/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I dislike static methods, there I said it.</p>

<p>Like everything, they have their place; but as the old analogy says, when you have a hammer everything looks like a nail. <strong>Static methods are being abused.</strong></p>

<h2>Don&#8217;t make me instantiate</h2>

<p>For some reason programmers seem to be allergic to instantiating objects, to the point of where half the functionality is implemented in static classes and methods. You can go for days without seeing an instance in my current project&#8217;s code-base.</p>

<p>I think it&#8217;s symptomatic of a bigger problem. If you think creating instances is wasteful, maybe you&#8217;re creating too many. You&#8217;re most likely violating the Single Responsibility Principal (SRP) or Separation of Concerns (SoC). Too many dependencies usually means your class is trying to do too much, get it spit-up, and get it clean.</p>

<h2>State vs. stateless</h2>

<p>One justification for using static methods that is often touted around is that if a method doesn&#8217;t have any state, then it should be static. To me this is a fallacy, because state isn&#8217;t everything. Take the following repository example:</p>

<h3>Using static methods</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="n">Customer</span> <span class="n">customer</span> <span class="p">=</span> <span class="n">Repository</span><span class="p">&lt;</span><span class="n">Customer</span><span class="p">&gt;.</span><span class="n">FindByID</span><span class="p">(</span><span class="m">102</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">customer</span><span class="p">.</span><span class="n">Name</span> <span class="p">=</span> <span class="s">&quot;James&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">Repository</span><span class="p">&lt;</span><span class="n">Customer</span><span class="p">&gt;.</span><span class="n">Save</span><span class="p">(</span><span class="n">customer</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Using an instance</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="n">IRepository</span><span class="p">&lt;</span><span class="n">Customer</span><span class="p">&gt;</span> <span class="n">repos</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Repository</span><span class="p">&lt;</span><span class="n">Customer</span><span class="p">&gt;();</span>
</span><span class='line'>
</span><span class='line'><span class="n">Customer</span> <span class="n">customer</span> <span class="p">=</span> <span class="n">repos</span><span class="p">.</span><span class="n">FindByID</span><span class="p">(</span><span class="m">102</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">customer</span><span class="p">.</span><span class="n">Name</span> <span class="p">=</span> <span class="s">&quot;James&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">repos</span><span class="p">.</span><span class="n">Save</span><span class="p">(</span><span class="n">customer</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Noticably the first example is one line less than the second. However, it&#8217;s compromising readability in removing that line. Instead of using the <code>repos</code> instance, you&#8217;re forced to fully-qualify every method call with <code>Repository<Customer></code>, which is introducing more noise per-line.</p>

<p>Even though the methods <code>FindByID</code> and <code>Save</code> don&#8217;t have any shared state, they both form a part of the encapsulation of data-access (in this case).</p>

<blockquote><p>If a method forms a key part of an encapsulation, then it shouldn&#8217;t be static.</p></blockquote>

<p>When you make the decision of creating a static method due to it being stateless, you&#8217;re revealing more implementation details than necessary. A big part of encapsulation is hiding implementation details from the consumer.</p>

<p>While the methods are stateless, they might not always be that way; perhaps the repository could share a session between calls in the future. With an instance based design, you won&#8217;t have any problems. Try introducing state into a static method, and things either get very messy, or you end up converting everything to instances and having to rewrite any usages.</p>

<blockquote><p>Static methods tie you in at an early stage to a specific design, making it very difficult to refactor out later.</p></blockquote>

<h2>Not all bad</h2>

<p>So where are the good static methods? <em>The <code>Math</code> class is a good example</em>. It contains a set of functions that are only loosely related (apart from being mathematical), that are guaranteed to be stateless, and most importantly are simple. Architecturally the methods in the <code>Math</code> class could be applied to a wide swath of objects (<code>int</code>, <code>float</code>, <code>double</code>, <code>decimal</code> etc&#8230;) and to have them as instance methods would complicate the class hierarchy more than it would benefit it.</p>

<blockquote><p>Static methods should be fire-and-forget, disposable, simple, and effective.</p></blockquote>

<h2>Object-orientation</h2>

<p>Static methods aren&#8217;t associated with an object, they&#8217;re tied to a type. This is a big distinction. People are under the belief that because statics sit in the same class definition as instance methods, that it makes them object-oriented.</p>

<p>Two key points of object-oriented design that static methods violate are inheritance and polymorphism. The inability to substitute a method with an implementation in a derived class is pretty unforgivable, and heavily restricting.</p>

<h2>Finally, testing</h2>

<p>The argument that you&#8217;re most likely to encounter against using static methods is that of testing. It&#8217;s certainly one that I agree with, I just didn&#8217;t want it to seem like that&#8217;s the main reason of my argument.</p>

<p>Statics are bad for testing because they can&#8217;t be substituted easily. A major part of unit testing is being able to isolate what you&#8217;re testing from it&#8217;s dependencies; isolation allows you to verify one part of the system at a time. Static methods aren&#8217;t overridable in a sub-class, and so they aren&#8217;t mockable either (without the use of TypeMock).</p>

<p>Of the two examples used above, in the first example it would be very hard to test that code without actually going to the database, because of the ties to the static methods. The second example could be refactored so the IRepository dependency is injected, and thus replaceable at test time.</p>

<p>Not being able to test in isolation is the final nail in the coffin for static methods and me.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/7/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/5/">Newer &rarr;</a>
    
  </div>
</div>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Website copyright &copy; 2014 - James Gregory |
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a> | Themed with <a href="https://github.com/TheChymera/Koenigspress">Königspress</a></span>.
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'jagregory';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
