
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>James Gregory</title>
  <meta name="author" content="James Gregory">

  
  <meta name="description" content="Jeff Atwood (of Coding Horror) tweeted earlier: &#8220;On Firefox: &#8216;add-ons aren&#8217;t a big draw for me &#8211; I just need a browser, not a &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.jagregory.com/blog/page/7">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="James Gregory" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href='http://fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Cardo:regular,italic,bold,bolditalic' rel='stylesheet' type='text/css'>

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-3186192-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<logo>

<img src="/logo.png" alt="Website Logo. Upload to /source/logo.png ; disable in /source/_includes/logo.html" height="32px" width="32px">
</logo>



<body >
  <header role="banner"><hgroup>
  <h1><a href="/">James Gregory</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

<br>
  
<!--
<ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
-->

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/writings/plug-ins-and-browsers/">Plug-in&#8217;s and Browsers</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-03-28T00:00:00+11:00" pubdate data-updated="true">Mar 28<span>th</span>, 2008</time>
        
           | <a href="/writings/plug-ins-and-browsers/#disqus_thread"
             data-disqus-identifier="http://www.jagregory.com/writings/plug-ins-and-browsers/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Jeff Atwood (of <a href="http://www.codinghorror.com">Coding Horror</a>) <a href="http://twitter.com/codinghorror/statuses/778279263">tweeted earlier</a>: &#8220;On Firefox: &#8216;add-ons aren&#8217;t a big draw for me &#8211; I just need a browser, not a circus.&#8217;&#8221;. I don&#8217;t know whether this was a quotation of himself, or someone else; but it&#8217;s something that I&#8217;ve heard mentioned before.</p>

<p>Just because they&#8217;re there, doesn&#8217;t mean you have to install them.</p>

<p>A plug-in model in your browser allows you to install as many, or as few, plug-ins as you need. A lot of them are useless, but if there&#8217;s one that can boost your productivity, isn&#8217;t that worth it? I&#8217;d rather have a browser with a plug-in model, and one really useful plug-in, than a browser without both.</p>

<p>A prime example is FireBug, I couldn&#8217;t live without that plug-in. I feel stranded in IE or Safari when it comes to interrogating pages.</p>

<p>FireBug possibly highlights a hole in the developer support from the Firefox development team itself, but with a plug-in model you can fill that hole yourself rather than relying on their team; like we&#8217;ve had to do for years with Microsoft and Internet Explorer.</p>

<p>/rant off</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/writings/getfilename-nant-task/">Getfilename NAnt Task</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-03-12T00:00:00+11:00" pubdate data-updated="true">Mar 12<span>th</span>, 2008</time>
        
           | <a href="/writings/getfilename-nant-task/#disqus_thread"
             data-disqus-identifier="http://www.jagregory.com/writings/getfilename-nant-task/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>As part of my current quest to fully automate our build, I found my self needing the ability to copy a database backup from our remote server. The backup is in a folder along with several other backups, with a filename based on the date. I didn&#8217;t fancy trying to programmatically guess the filename, so I wrote an NAnt task to grab the newest file in a directory. Thanks to <a href="http://blogs.geekdojo.net/rcase">Richard Case</a> for his overview of how to <a href="http://blogs.geekdojo.net/rcase/archive/2005/01/06/5971.aspx">create a custom NAnt task</a>.</p>

<p>The <code>getfilename</code> task simply gets the filename of a file in a directory, then pushes the name into the specified property. The filename to find can be based on the creation date, last modified date etc&#8230;</p>

<p>The attributes are as follows:</p>

<table class="format-table">
    <thead>
        <tr>
            <th>Attribute</th>
            <th>Description</th>
            <th>Required</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>in</td>
            <td>The directory to search</td>
            <td>Yes</td>
        </tr>
        <tr class="alt">
            <td>property</td>
            <td>The property to push the filename into.</td>
            <td>Yes</td>
        </tr>
        <tr>
            <td>searchPattern</td>
            <td>Wildcard search pattern for finding the file.</td>
            <td>No</td>
        </tr>
        <tr class="alt">
            <td>of</td>
            <td>
                The file to get the filename of.<br /><br />
                <strong>NewestFile</strong> - The most recently created file<br />
                <strong>OldestFile</strong> - The oldest file in the directory<br />
                <strong>FirstModifiedFile</strong> - The file with the oldest last modified date<br />
                <strong>LastModifiedFile</strong> - The most recently modified file<br />
                <strong>FirstFile</strong> - The first file in the directory, using default sorting<br />
                <strong>LastFile</strong> - The last file in the directory, using default sorting<br />
            </td>
            <td>No - Defaults to NewestFile</td>
        </tr>
    </tbody>
</table>


<p>An example usage is:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
</span><span class='line'><span class="nt">&lt;project</span> <span class="na">name=</span><span class="s">&quot;Example&quot;</span> <span class="na">default=</span><span class="s">&quot;run&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;target</span> <span class="na">name=</span><span class="s">&quot;run&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;getfilename</span> <span class="na">of=</span><span class="s">&quot;NewestFile&quot;</span> <span class="na">in=</span><span class="s">&quot;C:\path\to\backups&quot;</span> <span class="na">searchPattern=</span><span class="s">&quot;*.bak&quot;</span> <span class="na">property=</span><span class="s">&quot;filename&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;echo</span> <span class="na">message=</span><span class="s">&quot;Filename: ${filename}&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/target&gt;</span>
</span><span class='line'><span class="nt">&lt;/project&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Foreseeable usage situations revolve around anything where you&#8217;d need to get the last modified, or newest file in a directory; backups, database scripts etc&#8230;</p>

<h2>Downloads</h2>

<p>The DeleGrid is open-source under the <a href="http://en.wikipedia.org/wiki/BSD_license">new BSD License</a>; read the license for what youâ€™re allowed to do.</p>

<p>You can download the source here: <a href="http://jagregory.googlecode.com/files/JAGregory.NAntTasks-1.0-source.zip">Download Source</a>.
You can download the latest binary here: <a href="http://jagregory.googlecode.com/files/JAGregory.NAntTasks-1.0.zip">Download Binary</a>.</p>

<p>The source is also accessible from Subversion at: <a href="http://jagregory.googlecode.com/svn/trunk/JAGregory.NAntTasks/">http://jagregory.googlecode.com/svn/trunk/JAGregory.NAntTasks/</a> (using user jagregory-read-only)</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/writings/introducing-the-filterable-delegrid/">Introducing the Filterable DeleGrid</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-03-05T00:00:00+11:00" pubdate data-updated="true">Mar 5<span>th</span>, 2008</time>
        
           | <a href="/writings/introducing-the-filterable-delegrid/#disqus_thread"
             data-disqus-identifier="http://www.jagregory.com/writings/introducing-the-filterable-delegrid/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>The DeleGrid is a paged GridView control that handles data-binding through the use of events and delegates rather than with a traditional collection.</p>

<p>What this means is that you have full control over the data that is shown in the currently displayed page. Traditionally you&#8217;d retrieve the whole recordset then page it locally, but with the DeleGrid you can utilise your database/ORMs paging features.</p>

<p>To quote myself from when I first <a href="/writings/delegrid/">introduced the DeleGrid</a>:</p>

<blockquote><p>[The DeleGrid] came about because I wanted a nice way of implementing paging using NHibernate without having the grid know about it. I really didnâ€™t want NHibernate to leave my data layer, so I needed a nice way of the grid calling my DAL with the paging parameters.</p></blockquote>

<h2>What&#8217;s new?</h2>

<p>The biggest change in version 1.1 is the introduction of filtering. The filter isn&#8217;t generated in some black-box fashion, instead it&#8217;s defined by the programmer. It&#8217;s built up from the columns in the grid, which define their own filtering behaviour.</p>

<p>The filter acts upon any columns in the grid that implement the IFilterableField interface. Implementing this interface in your own fields is easy, so you&#8217;re quickly able to create custom filtering behavior for your grid. An example would be a date column, that has a date-picker as a filter control.</p>

<p><img src="/images/fd-1.png" alt="Filter Screenshot" /></p>

<p>I&#8217;ve chosen not to implement the wealth of appearance customisations that are available in the normal templated controls. This is down to two reasons, firstly I don&#8217;t agree with it, appearance should be controlled solely through CSS. Secondly, there are so many, I couldn&#8217;t be bothered. So you&#8217;re only able to attach CSS classes to the buttons and cells, and specify the image urls for the buttons.</p>

<h2>An example implementation</h2>

<p>The grid now has a companion project, it&#8217;s own data library. This separation is to keep you from having to reference System.Web in your data-layer. To use the DeleGrid in your project you&#8217;ll need to reference <code>JAGregory.Controls.DeleGrid.dll</code> and the <code>JAGregory.Controls.Data.dll</code> in your web project, then reference <code>JAGregory.Controls.Data.dll</code> in your data layer, if they&#8217;re separate projects.</p>

<p>So to begin with, add the reference to <code>JAGregory.Controls.DeleGrid.dll</code> and <code>JAGregory.Controls.Data.dll</code> into your web project. This will allow you to use the DeleGrid in your page. Once you&#8217;ve done that, you&#8217;ll need to reference the control in your page, you can either do this using a Register tag in your page, or in the web.config as so:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;pages&gt;</span>
</span><span class='line'>  <span class="nt">&lt;controls&gt;</span>
</span><span class='line'>    <span class="nt">&lt;add</span> <span class="na">tagPrefix=</span><span class="s">&quot;jag&quot;</span> <span class="na">namespace=</span><span class="s">&quot;JAGregory.Controls&quot;</span>
</span><span class='line'>      <span class="na">assembly=</span><span class="s">&quot;JAGregory.Controls.DeleGrid&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/controls&gt;</span>
</span><span class='line'><span class="nt">&lt;/pages&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>With that in place, you can now put the DeleGrid into your page:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='aspx-cs'><span class='line'><span class="nt">&lt;jag:DeleGrid</span> <span class="na">ID=</span><span class="s">&quot;grid&quot;</span> <span class="na">Runat=</span><span class="s">&quot;server&quot;</span> <span class="na">AllowFiltering=</span><span class="s">&quot;true&quot;</span>
</span><span class='line'>  <span class="na">AutoGenerateColumns=</span><span class="s">&quot;false&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;FilterStyle</span> <span class="na">ToggleOnImageUrl=</span><span class="s">&quot;img/find.png&quot;</span> <span class="na">ToggleOffImageUrl=</span><span class="s">&quot;img/find.png&quot;</span>
</span><span class='line'>      <span class="na">ExecuteImageUrl=</span><span class="s">&quot;img/go.png&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;Columns&gt;</span>
</span><span class='line'>        <span class="nt">&lt;jag:FilterableTextField</span> <span class="na">HeaderText=</span><span class="s">&quot;Name&quot;</span> <span class="na">DataField=</span><span class="s">&quot;Name&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;jag:FilterableBooleanField</span> <span class="na">HeaderText=</span><span class="s">&quot;Active&quot;</span> <span class="na">DataField=</span><span class="s">&quot;Active&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/Columns&gt;</span>
</span><span class='line'><span class="nt">&lt;/jag:DeleGrid&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>In this example I&#8217;m using a Customer object to bind against it, which simply has the Name and Active properties.</p>

<p>For this grid we&#8217;ve set AllowFiltering to true, which enables the filter, then we&#8217;ve set AutoGenerateColumns to false so we can add our own custom columns. The two columns both implement the aforementioned IFilterableField interface, which allows them to define their own filtering behaviour.</p>

<p>I&#8217;ve also set the image urls so the buttons will be visible.</p>

<p>Now that the page is set up, we need to get down to the binding. In your code-behind:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">OnInit</span><span class="p">(</span><span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">base</span><span class="p">.</span><span class="n">OnInit</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// attach the events for requesting the data and totals</span>
</span><span class='line'>  <span class="n">grid</span><span class="p">.</span><span class="n">TotalRecordCountRequest</span> <span class="p">+=</span> <span class="n">grid_TotalRecordCountRequest</span><span class="p">;</span>
</span><span class='line'>  <span class="n">grid</span><span class="p">.</span><span class="n">PageDataRequest</span> <span class="p">+=</span> <span class="n">grid_PageDataRequest</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">OnLoad</span><span class="p">(</span><span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">base</span><span class="p">.</span><span class="n">OnLoad</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="p">(!</span><span class="n">IsPostBack</span><span class="p">)</span>
</span><span class='line'>    <span class="n">grid</span><span class="p">.</span><span class="n">DataBind</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>What&#8217;ve just done is attach the TotalRecordCountRequest and PageDataRequest handlers to the grid, which respectively fetch the total record count for the full grid, and fetch the current page of data from the database; the implementations are below.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">private</span> <span class="n">IEnumerable</span> <span class="nf">grid_PageDataRequest</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">PageDataRequestEventArgs</span> <span class="n">e</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">CustomerRepository</span> <span class="n">repos</span> <span class="p">=</span> <span class="k">new</span> <span class="n">CustomerRepository</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// get the requested page of data from the database</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">repos</span><span class="p">.</span><span class="n">FindAllPaged</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">Range</span><span class="p">,</span> <span class="n">e</span><span class="p">.</span><span class="n">Sort</span><span class="p">,</span> <span class="n">e</span><span class="p">.</span><span class="n">Filters</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">private</span> <span class="kt">int</span> <span class="nf">grid_TotalRecordCountRequest</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">DataRequestEventArgs</span> <span class="n">e</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">CustomerRepository</span> <span class="n">repos</span> <span class="p">=</span> <span class="k">new</span> <span class="n">CustomerRepository</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// get the total records</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">repos</span><span class="p">.</span><span class="n">GetAllCount</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">Filters</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>I&#8217;m using a <a href="http://www.martinfowler.com/eaaCatalog/repository.html">repository pattern</a> to handle data-access. In the PageDataRequest handler we&#8217;re taking the range, sort, and filter info that the grid passed us and sending it off to the repository to get the data. Similarity the TotalRecordCountRequest handler does a similar thing but without the range or sort info.</p>

<p>That&#8217;s it really for using the DeleGrid, you just need to take the filter info and handle it using your specific ORM.</p>

<h2>Repository implementation</h2>

<p>Ok I&#8217;ll throw you a bone, here&#8217;s the repository implementation to show how easy it is using NHibernate:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">CustomerRepository</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="c1">/// &lt;summary&gt;</span>
</span><span class='line'>  <span class="c1">/// Creates a NHibernate ICriteria based on the filters.</span>
</span><span class='line'>  <span class="c1">/// &lt;/summary&gt;</span>
</span><span class='line'>  <span class="c1">/// &lt;param name=&quot;filters&quot;&gt;Filters to apply.&lt;/param&gt;</span>
</span><span class='line'>  <span class="c1">/// &lt;returns&gt;ICriteria&lt;/returns&gt;</span>
</span><span class='line'>  <span class="k">private</span> <span class="n">ICriteria</span> <span class="nf">CreateFilteredCriteria</span><span class="p">(</span><span class="n">FilterCriterionCollection</span> <span class="n">filters</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="n">ICriteria</span> <span class="n">criteria</span> <span class="p">=</span> <span class="n">SessionManager</span><span class="p">.</span><span class="n">CurrentSession</span>
</span><span class='line'>      <span class="p">.</span><span class="n">CreateCriteria</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">Customer</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// criterion handling - write this yourself depending on how your</span>
</span><span class='line'>    <span class="c1">// db filters (and what filter types you&#39;re supporting)</span>
</span><span class='line'>    <span class="k">foreach</span> <span class="p">(</span><span class="n">FilterCriterion</span> <span class="n">filter</span> <span class="k">in</span> <span class="n">filters</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="n">filter</span><span class="p">.</span><span class="n">Type</span> <span class="p">==</span> <span class="k">typeof</span><span class="p">(</span><span class="kt">string</span><span class="p">))</span>
</span><span class='line'>        <span class="n">criteria</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">Expression</span><span class="p">.</span><span class="n">Like</span><span class="p">(</span><span class="n">filter</span><span class="p">.</span><span class="n">FieldName</span><span class="p">,</span> <span class="s">&quot;%&quot;</span> <span class="p">+</span> <span class="n">filter</span><span class="p">.</span><span class="n">Value</span> <span class="p">+</span> <span class="s">&quot;%&quot;</span><span class="p">));</span>
</span><span class='line'>      <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">filter</span><span class="p">.</span><span class="n">Type</span> <span class="p">==</span> <span class="k">typeof</span><span class="p">(</span><span class="kt">bool</span><span class="p">))</span>
</span><span class='line'>        <span class="n">criteria</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">Expression</span><span class="p">.</span><span class="n">Eq</span><span class="p">(</span><span class="n">filter</span><span class="p">.</span><span class="n">FieldName</span><span class="p">,</span> <span class="n">filter</span><span class="p">.</span><span class="n">Value</span><span class="p">));</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="n">criteria</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">/// &lt;summary&gt;</span>
</span><span class='line'>  <span class="c1">/// Gets the total record count from the database using the filters.</span>
</span><span class='line'>  <span class="c1">/// &lt;/summary&gt;</span>
</span><span class='line'>  <span class="c1">/// &lt;param name=&quot;filters&quot;&gt;Filters to apply before getting the count.&lt;/param&gt;</span>
</span><span class='line'>  <span class="c1">/// &lt;returns&gt;Total number of records in the filtered list&lt;/returns&gt;</span>
</span><span class='line'>  <span class="k">public</span> <span class="kt">int</span> <span class="nf">GetAllCount</span><span class="p">(</span><span class="n">FilterCriterionCollection</span> <span class="n">filters</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="nf">CreateFilteredCriteria</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span>
</span><span class='line'>      <span class="p">.</span><span class="n">SetProjection</span><span class="p">(</span><span class="n">Projections</span><span class="p">.</span><span class="n">Count</span><span class="p">(</span><span class="s">&quot;ID&quot;</span><span class="p">))</span>
</span><span class='line'>      <span class="p">.</span><span class="n">UniqueResult</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">/// &lt;summary&gt;</span>
</span><span class='line'>  <span class="c1">/// Gets one page of data from the database.</span>
</span><span class='line'>  <span class="c1">/// &lt;/summary&gt;</span>
</span><span class='line'>  <span class="c1">/// &lt;param name=&quot;range&quot;&gt;Select range (start ID and number of records).&lt;/param&gt;</span>
</span><span class='line'>  <span class="c1">/// &lt;param name=&quot;sort&quot;&gt;Sorting to apply.&lt;/param&gt;</span>
</span><span class='line'>  <span class="c1">/// &lt;param name=&quot;filters&quot;&gt;Filters to apply.&lt;/param&gt;</span>
</span><span class='line'>  <span class="c1">/// &lt;returns&gt;List for one page of data.&lt;/returns&gt;</span>
</span><span class='line'>  <span class="k">public</span> <span class="n">IList</span><span class="p">&lt;</span><span class="n">Customer</span><span class="p">&gt;</span> <span class="n">FindAllPaged</span><span class="p">(</span><span class="n">SelectRange</span> <span class="n">range</span><span class="p">,</span> <span class="n">SortInfo</span> <span class="n">sort</span><span class="p">,</span> <span class="n">FilterCriterionCollection</span> <span class="n">filters</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="c1">// create the criteria using the filters, then set the range</span>
</span><span class='line'>    <span class="n">ICriteria</span> <span class="n">criteria</span> <span class="p">=</span> <span class="n">CreateFilteredCriteria</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span>
</span><span class='line'>      <span class="p">.</span><span class="n">SetFirstResult</span><span class="p">(</span><span class="n">range</span><span class="p">.</span><span class="n">Start</span><span class="p">)</span>
</span><span class='line'>      <span class="p">.</span><span class="n">SetMaxResults</span><span class="p">(</span><span class="n">range</span><span class="p">.</span><span class="n">Size</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// only add the sort if one is specified</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(!</span><span class="kt">string</span><span class="p">.</span><span class="n">IsNullOrEmpty</span><span class="p">(</span><span class="n">sort</span><span class="p">.</span><span class="n">Field</span><span class="p">))</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="n">sort</span><span class="p">.</span><span class="n">Direction</span> <span class="p">==</span> <span class="n">Direction</span><span class="p">.</span><span class="n">Asc</span><span class="p">)</span>
</span><span class='line'>        <span class="n">criteria</span><span class="p">.</span><span class="n">AddOrder</span><span class="p">(</span><span class="n">Order</span><span class="p">.</span><span class="n">Asc</span><span class="p">(</span><span class="n">sort</span><span class="p">.</span><span class="n">Field</span><span class="p">));</span>
</span><span class='line'>      <span class="k">else</span>
</span><span class='line'>        <span class="n">criteria</span><span class="p">.</span><span class="n">AddOrder</span><span class="p">(</span><span class="n">Order</span><span class="p">.</span><span class="n">Desc</span><span class="p">(</span><span class="n">sort</span><span class="p">.</span><span class="n">Field</span><span class="p">));</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="n">criteria</span><span class="p">.</span><span class="n">List</span><span class="p">&lt;</span><span class="n">Customer</span><span class="p">&gt;();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The <code>CreateFilteredCriteria</code> method is doing most of the leg work. It takes creates an NHibernate criteria, then adds any filter criterions to it. It iterates the filters collection, checking their type and adding the appropriate NHibernate criterion. Simple!</p>

<h2>The example project</h2>

<p>I&#8217;ve attached a sample project that uses the grid to display a collection of customers that are paged and filtered. The example uses a SQLite database with NHibernate for data-access, I&#8217;ve done this to keep the extraneous code to a minimum.</p>

<h2>Downloads</h2>

<p>The DeleGrid is open-source under the <a href="http://en.wikipedia.org/wiki/BSD_license">new BSD License</a>; read the license for what youâ€™re allowed to do.</p>

<p>You can download the source here: <a href="http://jagregory.googlecode.com/files/DeleGrid-1.1-source.zip">Download Source</a>.
You can download the latest binary here: <a href="http://jagregory.googlecode.com/files/DeleGrid-1.1.zip">Download Binary</a>.
You can download the example project here: <a href="http://jagregory.googlecode.com/files/DeleGridExample.zip">Download Example</a>.</p>

<p>The source is also accessible from Subversion at: <a href="http://jagregory.googlecode.com/svn/trunk/DeleGrid/">http://jagregory.googlecode.com/svn/trunk/DeleGrid/</a> (using user jagregory-read-only)</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/writings/objectfield-11/">ObjectField 1.1</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-02-21T00:00:00+11:00" pubdate data-updated="true">Feb 21<span>st</span>, 2008</time>
        
           | <a href="/writings/objectfield-11/#disqus_thread"
             data-disqus-identifier="http://www.jagregory.com/writings/objectfield-11/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I&#8217;ve updated the <code>ObjectField</code> to be considerably simpler than it was before. While writing my <a href="/writings/data-binding-hierarchical-objects/">Data-binding hierarchical objects</a> post I wrote this about the <code>BoundField</code> implementation:</p>

<blockquote><p>Using a <code>TypeDescriptor</code> to get the property&#8230; This strikes me as a bit odd to be honest, because the <code>DataBinder</code> has the ability to evaluate a hierarchical path.</p></blockquote>

<p>Which is interesting, because I was using a <code>TypeDescriptor</code> in my <code>ObjectField</code> implementation!</p>

<p>Originally, the <code>ObjectField</code> was using the method below to evaluate the hierarchical paths, which to be honest is a bit verbose.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">private</span> <span class="kt">object</span> <span class="nf">GetNestedValue</span><span class="p">(</span><span class="kt">object</span> <span class="n">component</span><span class="p">,</span> <span class="kt">string</span> <span class="n">field</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">string</span><span class="p">[]</span> <span class="n">properties</span> <span class="p">=</span> <span class="n">field</span><span class="p">.</span><span class="n">Split</span><span class="p">(</span><span class="sc">&#39;.&#39;</span><span class="p">);</span>
</span><span class='line'>  
</span><span class='line'>  <span class="k">foreach</span> <span class="p">(</span><span class="kt">string</span> <span class="n">property</span> <span class="k">in</span> <span class="n">properties</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">PropertyDescriptor</span> <span class="n">descriptor</span> <span class="p">=</span>
</span><span class='line'>          <span class="n">TypeDescriptor</span><span class="p">.</span><span class="n">GetProperties</span><span class="p">(</span><span class="n">component</span><span class="p">).</span><span class="n">Find</span><span class="p">(</span><span class="n">property</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
</span><span class='line'>      
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="n">descriptor</span> <span class="p">==</span> <span class="k">null</span> <span class="p">&amp;&amp;</span> <span class="p">!</span><span class="n">AllowNulls</span><span class="p">)</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>          <span class="c1">// no descriptor, and we&#39;re not allowing nulls so complain that</span>
</span><span class='line'>          <span class="c1">// we can&#39;t find the object</span>
</span><span class='line'>          <span class="k">throw</span> <span class="k">new</span> <span class="nf">HttpException</span><span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="n">Format</span><span class="p">(</span><span class="n">MissingFieldErrorMessage</span><span class="p">,</span>
</span><span class='line'>              <span class="n">property</span><span class="p">));</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">descriptor</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>          <span class="c1">// silently return, with the NullValue if present</span>
</span><span class='line'>          <span class="n">component</span> <span class="p">=</span> <span class="n">NullValue</span><span class="p">;</span>
</span><span class='line'>          <span class="k">break</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      
</span><span class='line'>      <span class="n">component</span> <span class="p">=</span> <span class="n">descriptor</span><span class="p">.</span><span class="n">GetValue</span><span class="p">(</span><span class="n">component</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="n">component</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The <code>GetNestedValue</code> method was splitting the <code>DataField</code> value and then recursively evaluating each property.</p>

<p>Here&#8217;s the same implementation using the <code>DataBinder</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="c1">// looking to bind against child-objects</span>
</span><span class='line'><span class="kt">object</span> <span class="n">component</span> <span class="p">=</span> <span class="n">DataBinder</span><span class="p">.</span><span class="n">GetDataItem</span><span class="p">(</span><span class="n">controlContainer</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="k">return</span> <span class="n">DataBinder</span><span class="p">.</span><span class="n">Eval</span><span class="p">(</span><span class="n">component</span><span class="p">,</span> <span class="n">DataField</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Magic!</p>

<p>As a side effect of this change, the <code>ObjectField</code> can now support everything regular data-binding does. So you can use indexers and such in your <code>DataField</code> now.</p>

<p>A couple of other things you should know: the <code>AllowNulls</code> property has been removed because it&#8217;s no longer supported, and the <code>NullValue</code> field has also been removed because the <code>BoundField</code> already supported it in the form of <code>NullDisplayText</code>.</p>

<h2>Downloads</h2>

<p>The ObjectField is open-source under the <a href="http://en.wikipedia.org/wiki/BSD_licenses">new BSD License</a>; read the license for what youâ€™re allowed to do.</p>

<p>You can download the source here: <a href="http://jagregory.googlecode.com/files/ObjectField-1.1-source.zip">Download Source</a>.
You can download the latest binary here: <a href="http://jagregory.googlecode.com/files/ObjectField-1.1.zip">Download Binary</a>.</p>

<p>The source is also accessible from Subversion at: <a href="http://jagregory.googlecode.com/svn/trunk/ObjectField/">http://jagregory.googlecode.com/svn/trunk/ObjectField/</a> (using user jagregory-read-only)</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/writings/data-binding-hierarchical-objects/">Data-binding Hierarchical Objects</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-02-21T00:00:00+11:00" pubdate data-updated="true">Feb 21<span>st</span>, 2008</time>
        
           | <a href="/writings/data-binding-hierarchical-objects/#disqus_thread"
             data-disqus-identifier="http://www.jagregory.com/writings/data-binding-hierarchical-objects/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>After my post about <a href="/writings/objectfield/">my ObjectField column</a>, I thought I&#8217;d elaborate a bit on why it&#8217;s necessary.</p>

<p>When you&#8217;re data binding against an object that isn&#8217;t flat (i.e. has properties that are more than simple types - namely classes), you are bound to encounter the following exception, which is caused by the <code>BoundField</code> incorrectly handling a hierarchical object path.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>A field or property with the name 'MySubObject.PropertyName' was not found on the selected data source.</span></code></pre></td></tr></table></div></figure>


<p>Take this following Customer object for example:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">Customer</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="p">...</span>
</span><span class='line'>  
</span><span class='line'>  <span class="k">public</span> <span class="n">ContactDetails</span> <span class="n">ContactDetails</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">contactDetails</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">ContactDetails</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="p">...</span>
</span><span class='line'>  
</span><span class='line'>  <span class="k">public</span> <span class="kt">string</span> <span class="n">TelephoneNumber</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">telephoneNumber</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>If you were to just use <code>DataField="ContactDetails"</code> on a <code>BoundField</code>, it would work fine because it&#8217;s binding against a property on your customer. However,  if you were to try to get the <code>TelephoneNumber</code> property of the <code>ContactDetails</code> by doing: <code>DataField="ContactDetails.TelephoneNumber"</code>, it would fail because the field can&#8217;t interpret the two property names; it treats the <code>DataField</code> as one big name, which obviously isn&#8217;t correct.</p>

<p>The <code>BoundField</code> simply isn&#8217;t capable of resolving this kind of hierarchical path using late-binding. This is because it uses the DataField as the literal property name on the component, using a TypeDescriptor to get the property.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="n">TypeDescriptor</span><span class="p">.</span><span class="n">GetProperties</span><span class="p">(</span><span class="n">component</span><span class="p">).</span><span class="n">Find</span><span class="p">(</span><span class="n">dataField</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>This strikes me as a bit odd to be honest, because the <code>DataBinder</code> has the ability to evaluate a hierarchical path. It&#8217;s pure speculation, but if this is a conscious decision it may be down to the performance implications of using late binding; however, I can&#8217;t see that it&#8217;s any worse than reflection.</p>

<p>Unfortunately there isn&#8217;t a solution to this if you still want to use the <code>BoundField</code>. If you don&#8217;t mind a bit of untidy mark-up, you can do this instead:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='aspx-cs'><span class='line'><span class="nt">&lt;asp:TemplateField&gt;</span>
</span><span class='line'>  <span class="nt">&lt;ItemTemplate&gt;</span>
</span><span class='line'>    <span class="nt">&lt;%#</span> <span class="n">Eval</span><span class="p">(</span><span class="s">&quot;ContactDetails.TelephoneNumber&quot;</span><span class="p">)</span> <span class="nt">%&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/ItemTemplate&gt;</span>
</span><span class='line'><span class="nt">&lt;/asp:TemplateField&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is pretty messy though, and you&#8217;re going to quadruple the markup for your columns; imagine having 10 of those, it&#8217;s going to get pretty ugly. My solution is to use the <a href="/writings/objectfield/">ObjectField I wrote about previously</a>, which is a column that derives from <code>BoundField</code> and overrides it&#8217;s binding mechanism, allowing it to correctly evaluate hierarchical paths.</p>

<p>The <code>ObjectField</code> allows you to use the familiar markup from the <code>BoundField</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='aspx-cs'><span class='line'><span class="nt">&lt;jag:ObjectField</span> <span class="na">BoundField=</span><span class="s">&quot;ContactDetails.TelephoneNumber&quot;</span> <span class="nt">/&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Hopefully one of those solutions will suit you. Personally I&#8217;d prefer to see the <code>ObjectField</code>, or other derived field, instead of the nasty <code>TemplateField</code> usage.</p>

<p><em>This is a follow up to my ObjectField post, because a few people have been hitting that page in search of the exception, which it doesn&#8217;t really cover.</em></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/writings/objectfield/">ObjectField - a GridView Field</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-02-17T00:00:00+11:00" pubdate data-updated="true">Feb 17<span>th</span>, 2008</time>
        
           | <a href="/writings/objectfield/#disqus_thread"
             data-disqus-identifier="http://www.jagregory.com/writings/objectfield/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><blockquote><p>The version of the ObjectField that this post refers to is now out of date. Please go to the <a href="/writings/objectfield-11/">ObjectField 1.1</a> post for the latest version.</p></blockquote>

<p>I encountered a problem while binding a complex object to a GridView, in that the BoundField doesn&#8217;t support specifying a nested value in it&#8217;s DataField property. So if you have a list of Customer&#8217;s, and want to display the TelephoneNumber property from inside the customer&#8217;s ContactDetails property, you&#8217;re out of luck.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='aspx-cs'><span class='line'><span class="nt">&lt;asp:BoundField</span> <span class="na">DataField=</span><span class="s">&quot;ContactDetails.TelephoneNumber&quot;</span> <span class="nt">/&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>The above would fall over with an exception along the lines of:
<code>A field or property with the name 'ContactDetails.TelephoneNumber' was not found on the selected data source.</code></p>

<p>This is a mind-boggling flaw in the BoundField, with the main solution being to create a nested GridView, which is just overkill for most situations. This problem especially rears it&#8217;s ugly head if you&#8217;re using an ORM layer such as <a href="http://www.nhibernate.org/">NHibernate</a> or <a href="http://www.subsonicproject.com">SubSonic</a>.</p>

<p>So what have I done? I&#8217;ve just gone and created a solution to this problem.</p>

<p>Introducing the ObjectField, a GridView field that allows binding against hierarchical structured objects. In short, it takes a BoundField and splits it on full-stops (periods!) using each element to find an object.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='aspx-cs'><span class='line'><span class="nt">&lt;jag:ObjectField</span> <span class="na">DataField=</span><span class="s">&quot;ContactDetails.TelephoneNumber&quot;</span> <span class="nt">/&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>The above is now possible! Huzzah.</p>

<h2>Extras</h2>

<p>There&#8217;s one extra thing you should know about. The field has a couple of additional properties that can be useful.</p>

<p>The first is <code>AllowNulls</code> which defaults to <code>true</code>, this will make the field return silently when a null is encountered anywhere along the object hierarchy; this can be useful if you know that there might be a null somewhere along the lines.</p>

<p>The second property is <code>NullValue</code>, which is displayed by the field when <code>AllowNulls</code> is <code>true</code> and a null is encountered. Setting this value allows you to give a user-friendly message if a value is null.</p>

<h2>Downloads</h2>

<p>The ObjectField is open-source under the <a href="http://en.wikipedia.org/wiki/BSD_licenses">new BSD License</a>; read the license for what youâ€™re allowed to do.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/writings/nhibernate-and-the-sqltypeexception/">NHibernate and the SqlTypeException</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2007-12-18T00:00:00+11:00" pubdate data-updated="true">Dec 18<span>th</span>, 2007</time>
        
           | <a href="/writings/nhibernate-and-the-sqltypeexception/#disqus_thread"
             data-disqus-identifier="http://www.jagregory.com/writings/nhibernate-and-the-sqltypeexception/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://www.nhibernate.org">NHibernate</a> is a wonderful piece of technology, I love it probably more than is reasonable for code. It does however, occasionally scare you with some seemingly odd behavior. I say seemingly, because every time I&#8217;ve had trouble it&#8217;s actually ended up being my own fault. <em>This is one of those times.</em></p>

<p>Picture a simple page, with a <a href="/writings/delegrid/">DeleGrid</a> control, being bound using NHiberate. Baring in mind how the DeleGrid works, two queries were being executed, one to return the first page of data and another to get the total row-count for the grid. <em>These queries were identical apart from the paging in one, and the projection in the other.</em></p>

<p>Upon execution of the second query, NHibernate was throwing a <code>SqlTypeException</code> for a <code>SqlDateTime</code> overflow. <code>SqlDateTime overflow. Must be between 1/1/1753 12:00:00 AM and 12/31/9999 11:59:59 PM</code>. This was pretty bizarre. Why on earth would the first query succeed (and bring back records, fully populated), but the same query again would die.</p>

<p>A good place to start for NHibernate debugging is always the logs, so I delved in. I discovered NHibernate was attempting to execute an update statement just before it tried the second query. It just kept getting stranger, why would a straightforward query cause an update?</p>

<p>I thought i&#8217;d investigate why the update statement was failing first, then I&#8217;d tackle the problem of why it was even updating at all. Looking at the query I identified the column that was causing the exception, it was (as expected) a <code>DateTime</code> column that was trying to be set to <code>DateTime.MinValue</code>. This exception is thrown because .Net and SQL Server have different ideas over what the minimum value for a <code>DateTime</code> should be.</p>

<p>Now, why would this column be being set at all? Well, it ends up that the column in the database was nullable, but the property in the object wasn&#8217;t. So because <code>DateTime</code> is a value type and cannot be set to <code>null</code>, NHibernate was populating it with the closest value to <code>null</code> as it could manage.</p>

<p>That was the key, as soon as I had that realisation, it was obvious what the problem was.</p>

<p>NHibernate knew that the database had a nullable column, but it had to manage with the non-nullable field on the object. When it came to run the second query, it noticed that the property wasn&#8217;t null as the mapping file said it should be, so it determined the value must have changed. It then attempted to persist those changes before executing the query!</p>

<h2>To break it down</h2>

<ol>
  <li>Nullable column pulled into a non-nullable field forces NHibernate to create the smallest value it can.</li>
  <li>NHibernate then checks for any changes, expecting a <code>null</code> on that field but finding a value.</li>
  <li>Object now considered dirty because value has allegedly changed.</li>
  <li>NHibernate performs an update before it pulls back the data agian.</li>
</ol>


<p>So the fix was simply to make the <code>DateTime</code> in the object a <code>DateTime?</code>, a nullable <code>DateTime</code>. That got rid of the false update, and fixed my queries. Simple when you know what the problem is.</p>

<p><strong>So the moral of the story is:</strong> Make sure everything is in sync - schema, mappings and POCOs.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/writings/percieved-value-and-developer-education/">Percieved Value and Developer Education</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2007-12-12T00:00:00+11:00" pubdate data-updated="true">Dec 12<span>th</span>, 2007</time>
        
           | <a href="/writings/percieved-value-and-developer-education/#disqus_thread"
             data-disqus-identifier="http://www.jagregory.com/writings/percieved-value-and-developer-education/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>A <a href="http://codebetter.com/blogs/jeremy.miller/archive/2007/12/12/my-pick-for-altnetconf-quote-of-the-day.aspx#171928">comment</a> on a <a href="http://codebetter.com/blogs/jeremy.miller/archive/2007/12/12/my-pick-for-altnetconf-quote-of-the-day.aspx">post at Jeremy D. Miller&#8217;s blog</a> caught my eye. To paraphrase, Jeff Tucker says that part of the problem of the lack of perceived value of ORM/TDD/IOC etc is down to the developers in question not having experienced the reason these tools exist.</p>

<p>He makes a fair point really, we use tools because they solve a problem for us, if we haven&#8217;t actually experienced what they&#8217;re solving then their value is appears to be much less than what it is. Similarly, the value of such tools and methodologies is nil when there is a lack of recognition of a problem even existing.</p>

<p>However, I don&#8217;t think the solution is to have developers learn &#8220;the hard way&#8221;. To discover the problem before using the solution is a problem in its-self. If we were to all learn from our own mistakes, and not from each-others, then we&#8217;re not going to make much progress as we&#8217;re all going to be solving the same problems.</p>

<p>Most people will have struggled with whatever problem has necessitated the creation of these tools/methodologies, so I think it&#8217;s more a case of helping the developers connect the dots; &#8220;You remember such and such a problem? Well that&#8217;s easily solved using methodology/technology x!&#8221;, rather than making them retrace the steps of every developer before them.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/writings/on-testing-implementation/">On Testing Implementation</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2007-12-10T00:00:00+11:00" pubdate data-updated="true">Dec 10<span>th</span>, 2007</time>
        
           | <a href="/writings/on-testing-implementation/#disqus_thread"
             data-disqus-identifier="http://www.jagregory.com/writings/on-testing-implementation/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I&#8217;ve found my-self in the situation of retro-fitting a library of code with unit tests, not a good situation to be in. However, what&#8217;s more concerning is I&#8217;ve just caught my-self writing tests that are heavily testing the implementation of a method; rather than simply testing if the method does what it&#8217;s supposed to.</p>

<p>There are a few problems with falling into this trap. Firstly, it&#8217;s very brittle. Secondly, you shouldn&#8217;t be concerned with the internals. Thirdly, it&#8217;s very time consuming.</p>

<p>To elaborate&#8230;</p>

<p>It&#8217;s brittle because you&#8217;re essentially writing a script of how the method is going to execute, which of course will change whenever you do any refactoring. So your tests break every time you make a change to your code, which is not only annoying, but will quickly lead to <a href="http://martinfowler.com/bliki/TestCancer.html">test cancer</a>, where tests aren&#8217;t run or are commented out.</p>

<p>You shouldn&#8217;t be concerned with the internals, because as long as your method is doing as requested, you shouldn&#8217;t really care how it&#8217;s achieving it&#8217;s goal. Not bolting down the internals allows methods to be refactored without too much resistance from the tests. This will increase the signal-to-noise ratio, allowing failing tests to be representative of a problem greater than your basic refactorings.</p>

<p>Finally, it&#8217;s time consuming simply because you&#8217;re duplicating most of your work. All the time you spent writing the method (or the test, if done first) is then duplicated writing the tests (or code&#8230;). This is a pain, because as mentioned above, you&#8217;ll keep doing this work every time you change the method.</p>

<p>The hardest part is learning how to not do this kind thing blindly. There are plenty of times when you&#8217;ll need this kind of testing, but don&#8217;t make it your default! Test expectations, not implementations.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/writings/delegrid/">DeleGrid - a Paged GridView Control</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2007-12-09T00:00:00+11:00" pubdate data-updated="true">Dec 9<span>th</span>, 2007</time>
        
           | <a href="/writings/delegrid/#disqus_thread"
             data-disqus-identifier="http://www.jagregory.com/writings/delegrid/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>Introducing the DeleGrid</h2>

<p>The DeleGrid is a control derived from the ASP.Net GridView, that delegates its data retrieval back out of the control. This allows the developer full control over the records that are retrieved, thus allowing proper paging to be implemented using whatever collection type you prefer.</p>

<h3>Why the DeleGrid?</h3>

<p>It came about because I wanted a nice way of implementing paging using NHibernate without having the grid know about it. I really didn&#8217;t want NHibernate to leave my data layer, so I needed a nice way of the grid calling my DAL with the paging parameters.</p>

<p>I didn&#8217;t want to utilise the ObjectDataSource because honestly, it made me feel dirty. I&#8217;m all for delegation and composition, but not when it means creating a control in my HTML that acts as a DAL. Additionally, I didn&#8217;t feel the ObjectDataSource was very type-safe, or refactor-friendly, with the method names and types exposed in the HTML. Granted, the IDE would probably pick it up, but I don&#8217;t want to risk a runtime failure on it.</p>

<h2>Using the DeleGrid (aka The Example)</h2>

<p>After getting the source or assembly and doing the usual song-and-dance, add a reference to the control to your page:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='aspx-cs'><span class='line'><span class="nt">&lt;%@</span> <span class="n">Register</span> <span class="n">Assembly</span><span class="p">=</span><span class="s">&quot;JAGregory.Controls.DeleGrid&quot;</span> <span class="n">Namespace</span><span class="p">=</span><span class="s">&quot;JAGregory.Controls&quot;</span> <span class="n">TagPrefix</span><span class="p">=</span><span class="s">&quot;jag&quot;</span> <span class="nt">%&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then create an instance of the control, turning the paging on and setting the correct page size:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='aspx-cs'><span class='line'><span class="nt">&lt;jag:DeleGrid</span> <span class="na">ID=</span><span class="s">&quot;grid&quot;</span> <span class="na">runat=</span><span class="s">&quot;server&quot;</span> <span class="na">AllowPaging=</span><span class="s">&quot;true&quot;</span> <span class="na">PageSize=</span><span class="s">&quot;4&quot;</span> <span class="nt">/&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now you have a control set up, however it sill won&#8217;t bind correctly. So, you need to attach the event handlers in the code-behind.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">OnInit</span><span class="p">(</span><span class="n">EventArgs</span> <span class="n">eventArgs</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">base</span><span class="p">.</span><span class="n">OnInit</span><span class="p">(</span><span class="n">eventArgs</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">grid</span><span class="p">.</span><span class="n">TotalRecordCountRequest</span> <span class="p">+=</span> <span class="k">delegate</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">// code to get total</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Starting with the TotalRecordCountRequest, this event is raised when the grid needs to know how many records in total your grid is going to be displaying. This number is the cumulative count of all the pages. I&#8217;m going to use a simple repository pattern to factor away my DAL logic.</p>

<p>The OnInit method is now:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">OnInit</span><span class="p">(</span><span class="n">EventArgs</span> <span class="n">eventArgs</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">base</span><span class="p">.</span><span class="n">OnInit</span><span class="p">(</span><span class="n">eventArgs</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">ProductRepository</span> <span class="n">repos</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ProductRepository</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">grid</span><span class="p">.</span><span class="n">TotalRecordCountRequest</span> <span class="p">+=</span> <span class="k">delegate</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">repos</span><span class="p">.</span><span class="n">GetTotal</span><span class="p">();</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now your grid knows how many records it has overall, however we still haven&#8217;t told it how to actually get the data. So now to put the code in the PageDataRequest handler. This event is raised when the grid is needing a new page of data, this will get called once on initial data-bind, then again every time you change the page (or sorting etc&#8230;).</p>

<p>The OnInit method is now:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">OnInit</span><span class="p">(</span><span class="n">EventArgs</span> <span class="n">eventArgs</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">base</span><span class="p">.</span><span class="n">OnInit</span><span class="p">(</span><span class="n">eventArgs</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">ProductRepository</span> <span class="n">repos</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ProductRepository</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">grid</span><span class="p">.</span><span class="n">TotalRecordCountRequest</span> <span class="p">+=</span> <span class="k">delegate</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">repos</span><span class="p">.</span><span class="n">GetTotal</span><span class="p">();</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'>  <span class="n">grid</span><span class="p">.</span><span class="n">PageDataRequest</span> <span class="p">+=</span> <span class="k">delegate</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">DataRequestEventArgs</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">repos</span><span class="p">.</span><span class="n">GetRange</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">Start</span><span class="p">,</span> <span class="n">e</span><span class="p">.</span><span class="n">Size</span><span class="p">);</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The event-handler receives an instance of DataRequestEventArgs, which contains the start index of the current page of data, and the number of records in a page. It also contains a SortField and SortDirection, for when sorting is enabled on the grid; however, we aren&#8217;t utilising them in this example.</p>

<p>Finally we just need to bind the grid on page load. We don&#8217;t re-bind the grid on post-back, due to that being handled internally in the DeleGrid.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">OnLoad</span><span class="p">(</span><span class="n">EventArgs</span> <span class="n">eventArgs</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">base</span><span class="p">.</span><span class="n">OnLoad</span><span class="p">(</span><span class="n">eventArgs</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="p">(!</span><span class="n">IsPostBack</span><span class="p">)</span>
</span><span class='line'>    <span class="n">grid</span><span class="p">.</span><span class="n">DataBind</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>That&#8217;s all there is to it!</p>

<p>You don&#8217;t need to use delegates, the normal event-handler syntax is fine (and probably preferred for larger examples). I just did it this way for brevity&#8217;s sake.</p>

<h2>Further reading&#8230;</h2>

<h3>Testing</h3>

<p>I&#8217;ve written a small number of tests that cover the implementation of the grid as best I can. There was only so-far I was willing to go to test the control, as it&#8217;s heavily tied to the ASP.Net implementation; which can get pretty messy for testing without using something like NUnitASP, which was a bit much for one control.. I&#8217;ve got coverage of about 85% of the code, which I&#8217;d say is pretty reasonable anyway.</p>

<h3>Sorting</h3>

<p>As mentioned above, you can implement sorting in your handlers by accessing the SortField and SortDirection properties of the event arguments.</p>

<h3>DeleGrid.AlwaysRequestTotal</h3>

<p>By default the DeleGrid only requests the total number of records on the initial data-bind, however if you see this as being a problem (such as with rapidly changing data-sets), you may want to set this property to true so it refreshes the total on every data-bind.</p>

<h2>Downloads</h2>

<p>The DeleGrid is open-source under the <a href="http://en.wikipedia.org/wiki/BSD_licenses">new BSD License</a>; read the license for what you&#8217;re allowed to do.</p>

<p>You can download the source here: <a href="http://jagregory.googlecode.com/files/DeleGrid-1.0-source.zip">Download Source</a>.</p>

<p>You can download the latest binary here: <a href="http://jagregory.googlecode.com/files/DeleGrid-1.0.zip">Download Binary</a>.</p>

<p>The source is also accessible from Subversion at: <a href="http://jagregory.googlecode.com/svn/trunk/DeleGrid/">http://jagregory.googlecode.com/svn/trunk/DeleGrid/</a> (using user jagregory-read-only)</p>

<p><strong>All patches are welcomed with open arms!</strong></p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/8/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/6/">Newer &rarr;</a>
    
  </div>
</div>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Website copyright &copy; 2014 - James Gregory |
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a> | Themed with <a href="https://github.com/TheChymera/Koenigspress">KÃ¶nigspress</a></span>.
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'jagregory';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
