<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

    <title>James Gregory</title>
    <meta name="description" content="Jack of all trades, master of none. Principal Consultant at Thoughtworks. Pronouns: he/him
" />

    <meta name="HandheldFriendly" content="True" />
    <meta name="MobileOptimized" content="320" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" type="text/css" href="/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400" />
    <!-- Customisation  -->
    <link rel="stylesheet" type="text/css" href="/css/main.css" />

</head>
<body class="home-template">

    <header class="main-header post-head no-cover">
    <nav class="main-nav  clearfix">
        <a class="back-button icon-arrow-left" href="/">Home</a>
    </nav>
</header>

<main class="content" role="main">

    <article class="post">

        <header class="post-header">
            <h1 class="post-title">Fluent NHibernate: Auto Mapping Entity Conventions</h1>
            <section class="post-meta">
                <time class="post-date" datetime="2009-01-11">11 Jan 2009</time>
                
            </section>
        </header>

        <section class="post-content">
            <blockquote>
  <p><strong>Notice:</strong> The content in this post is out of date, please refer to the <a href="https://github.com/jagregory/fluent-nhibernate/wiki/Auto-mapping">Auto Mapping</a> page in the <a href="https://github.com/jagregory/fluent-nhibernate/wiki">Fluent NHibernate Wiki</a> for the latest version.</p>
</blockquote>

<p>This post should be short and sweet. We want to alter our <strong>has many</strong> relationship from <code class="language-plaintext highlighter-rouge">Shelf</code> to <code class="language-plaintext highlighter-rouge">Product</code> so that it has a cascade set on it. We don’t want this to affect all one-to-many’s in our domain, so we need to do this alteration only on the <code class="language-plaintext highlighter-rouge">Shelf</code> entity rather than with an <code class="language-plaintext highlighter-rouge">ITypeConvention</code>.</p>

<!-- more -->

<p>So how exactly do you supply conventions only for a specific entity? Easy! with <code class="language-plaintext highlighter-rouge">ForTypesThatDeriveFrom&lt;T&gt;(ClassMap&lt;T&gt;)</code>.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">autoMappings</span>
  <span class="p">.</span><span class="nf">WithConvention</span><span class="p">(</span><span class="n">convention</span> <span class="p">=&gt;</span>
  <span class="p">{</span>
    <span class="c1">// our conventions</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="n">ForTypesThatDeriveFrom</span><span class="p">&lt;</span><span class="n">Shelf</span><span class="p">&gt;(</span><span class="n">map</span> <span class="p">=&gt;</span>
  <span class="p">{</span>
    <span class="n">map</span><span class="p">.</span><span class="n">HasMany</span><span class="p">&lt;</span><span class="n">Product</span><span class="p">&gt;()</span>
      <span class="p">.</span><span class="n">Cascade</span><span class="p">.</span><span class="nf">All</span><span class="p">();</span>
  <span class="p">});</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">ForTypesThatDeriveFrom</code> method takes a generic parameter that’s the entity you want to customise. The parameter is an expression that allows you to alter the underlying <code class="language-plaintext highlighter-rouge">ClassMap&lt;T&gt;</code> that is generated by the auto mapper. Anything you can do in the non-auto fluent mapping, you can do in this override. So for our case, we map a <code class="language-plaintext highlighter-rouge">HasMany</code> of <code class="language-plaintext highlighter-rouge">Product</code>, and specify it’s cascade; this overrides the <code class="language-plaintext highlighter-rouge">HasMany</code> that will have been generated by the auto mapper.</p>

<p>That’s it. We’ve overridden the auto mapping explicitly for a specific type, while not affecting the general conventions of the system. You can do this for as many types as you need in your domain; however, baring in mind readability, it may sometimes be more appropriate to map entities explicitly using the standard fluent mapping if you find yourself overriding a lot of conventions.</p>

        </section>

        

        <footer class="post-footer">
            <!-- If we want to display author's name and bio -->
            

            
        </footer>
    </article>
</main>

    <footer class="site-footer clearfix">
      <section class="copyright">
        <a href="mailto:james@jagregory.com">James Gregory</a> &copy;
              2022 &bull; <a rel="me" href="https://aus.social/@jagregory">Mastodon</a> &bull; All content licensed under <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">cc by-nc-sa 4.0</a>.
      </section>
    </footer>

    <script type="text/javascript" src="/js/jquery-1.11.1.min.js"></script>
    <script type="text/javascript" src="/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="/js/index.js"></script>
</body>
</html>
