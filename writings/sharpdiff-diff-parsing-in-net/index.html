
<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <title>SharpDiff - Diff Parsing in .NET - James Gregory</title>
    <meta name="author" content="James Gregory">

    
    <meta name="description" content="SharpDiff - Diff Parsing in .NET About SharpDiff SharpDiff is a library for parsing the output of various diffing tools. It&#8217;s primary purpose &hellip;">
    
    <meta name="viewport" content="width=device-width; initial-scale=1; maximum-scale=1">

    <link href="/atom.xml" rel="alternate" title="James Gregory" type="application/atom+xml">
    <link rel="canonical" href="">
    <link href="/favicon.png" rel="shortcut icon">
    <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
    <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    
    
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-3186192-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body>
	<header class="inner"><h1 class="left"><a href="/">James Gregory</a></h1>
<nav class="menu left"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</nav>
<div class="right">
	<form class="search right" action="http://google.com/search" method="get">
		<input class="left" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:www.jagregory.com">
	</form>
	<div class="social right">
		
		
		
		
		<a class="github" href="https://github.com/jagregory" title="GitHub">GitHub</a>
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
</div>

</header>
	
	<div id="content" class="inner"><article class="post">
    <h1 class="title">SharpDiff - Diff Parsing in .NET</h1>
    <div class="entry"><h2>About SharpDiff</h2>

<p>SharpDiff is a library for parsing the output of various diffing tools. It&#8217;s primary purpose is to reduce the time spent by SCM UI developers in handing diff output.</p>

<h2>Why SharpDiff</h2>

<p>I&#8217;ve got a few tools in mind that require parsing of diff files. I figure it&#8217;s a pretty common thing for SCM UI developers to have to do, so I thought i&#8217;d put it out for others to use.</p>

<h2>Parsing your first diff</h2>

<p>The implementation is not concrete yet, but the current (easiest) way to parse a diff file is as follows.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="kt">string</span> <span class="n">diffContent</span> <span class="p">=</span> <span class="n">File</span><span class="p">.</span><span class="n">ReadAllText</span><span class="p">(</span><span class="s">&quot;MyDiffFile.diff&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">Diff</span> <span class="n">diff</span> <span class="p">=</span> <span class="n">Diff</span><span class="p">.</span><span class="n">CreateFrom</span><span class="p">(</span><span class="n">diffContent</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>From there you have a compiled version of your diff document. Intellisense will be your friend here, but basically you have a Chunks collection, and a Files collection.</p>

<p>The Wikipedia <a href="http://en.wikipedia.org/wiki/Diff">article on Diffs</a> is worth a read if you&#8217;re interested. In short though, chunks are formed as a chunk header containing the affected lines, and the lines themselves.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='diff'><span class='line'><span class="gu">@@ -1,3 +1,6 @@</span>
</span><span class='line'>This is a small text file
</span><span class='line'><span class="gi">+that I quite like,</span>
</span><span class='line'> with a few lines of text
</span><span class='line'><span class="gd">-inside, nothing much.</span>
</span></code></pre></td></tr></table></div></figure>


<p>The chunk header is <code>@@ -1,3 +1,6 @@</code>. The -1,3 describes the affected lines in the original file, the first number (ignoring the minus) is the start line, and the second number is the total of context lines plus subtraction lines. The second range (+1,6) is in the new file, and that starts on the first line, and has six affected lines; in this case it&#8217;s all the context lines plus all addition lines.</p>

<p>All the other lines are the actual changes themselves. A line prefixed with a + is an addition line, a line prefixed with a - is a subtraction line, and lines prefixed with a space are context lines. Context lines are used for aligning the changes in the document. They&#8217;re also useful for determining if the document has changed since the diff was created.</p>

<p>In the context of SharpDiff, your Chunks collection contains an instance of a Chunk for every part in the diff that resembles the above. Each chunk has the range info for the original and new file, and a Lines collection of each line.</p>

<h2>Early Days</h2>

<p><strong>WARNING:</strong> SharpDiff is still in early development. I wouldn&#8217;t recommend using it in production code yet, as the parser is severely limited, and there&#8217;s next to no error handling.</p>

<p>The biggest flaw is that it only supports the standard git-diff output, and doesn&#8217;t handle many special circumstances.</p>

<p>It does support:</p>

<ul>
<li>Standard git-diff header</li>
<li>Index extended header</li>
<li>Chunk header</li>
<li>Chunk lines (added, removed, and contextual)</li>
<li>No newline at end of file</li>
<li>Multiple chunks per diff</li>
<li>Multiple diff per input string</li>
</ul>


<p>It doesn&#8217;t support:</p>

<ul>
<li>Other extended headers</li>
<li>Formats other than git-diff</li>
</ul>


<h2>Example</h2>

<p>As quick example of what you could use this library for, here&#8217;s a screenshot of a git-diff application:</p>

<p><img src="/images/sharpdiff-1.png" alt="Stupidly basic GUI" /></p>

<h2>Get Involved</h2>

<p>You can find the source on my github account, in the <a href="http://github.com/jagregory/sharpdiff">sharpdiff repository</a>.</p>

<p>If you&#8217;re interested in helping with SharpDiff, then let me know. All comments, suggestions, and contributions are welcome. Feel free to contact me either through github, or my e-mail.</p>
</div>
    <div class="meta">
        <div class="date">








  


<time datetime="2008-10-19T00:00:00+11:00" pubdate data-updated="true">Oct 19<span>th</span>, 2008</time></div>
        <div class="tags">

</div>
        
    </div>
</article>
<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
	
	
	<a class="addthis_button_tweet"></a>
	
	
	<a class="addthis_counter addthis_pill_style"></a>
	</div>
	<script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid=xa-4eb4a0c47196e907"></script>
</div>
</div>
	<footer class="inner">Copyright &copy; 2012 James Gregory</footer>
	<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script src="/javascripts/slash.js"></script>


<script type="text/javascript">
      var disqus_shortname = 'jagregory';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



</body>
</html>