<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

    <title>James Gregory</title>
    <meta name="description" content="Code monkey. ThoughtWorks. Chief Agitator.
" />

    <meta name="HandheldFriendly" content="True" />
    <meta name="MobileOptimized" content="320" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" type="text/css" href="/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400" />
    <!-- Customisation  -->
    <link rel="stylesheet" type="text/css" href="/css/main.css" />

</head>
<body class="home-template">

    <header class="main-header no-cover">
    <div class="vertical">
        <div class="main-header-content inner">
            <h1 class="page-title"><a href="/">James Gregory</a></h1>
            <h2 class="page-description">
                 Code monkey. ThoughtWorks. Chief Agitator.
 
            </h2>
        </div>
    </div>
    <a class="scroll-down icon-arrow-left" href="#content" data-offset="-45"><span class="hidden">Scroll Down</span></a>
</header>

<main id="content" class="content" role="main">
    <div class="extra-pagination inner">
        <nav class="pagination" role="pagination">
    
        
            <a class="newer-posts" href="/page19/" title="Previous Page">&laquo; Newer Posts</a>
      
    
    <span class="page-number"> Page 20 of 23 </span>
     
        <a class="older-posts" href="/page21/" title="Next Page">Older Posts &raquo;</a>
     
</nav>
    </div>

    

    <article class="post">
        <header class="post-header">
            <h2 class="post-title"><a href="/writings/ajax-and-security">AJAX and Security</a></h2>
        </header>
        <section class="post-excerpt">
            <p>I’ve been creating a content management system over the past few weeks with all the bells and whistles you’d expect from a new web project. One thing that has caught my eye is the potential security risk when using AJAX.</p>

<p>For said project I’ve been using the <a href="http://ajax.schwarz-interactive.de/csharpsample/default.aspx">Ajax.Net library</a> which, like most others, outputs wrapped calls to a server-side functions in javascript.</p>

<p>With that in mind then, surely anyone can open up the rendered source, see your methods and then execute them at will, potentially causing havoc. Initially I was using Ajax for most of my interaction with the server - something which seems pointless in hindsight. This meant that I had a create user function exposed to the public, potentially anyone could create themselves an account within the system by using the Javascript. This isn’t much of a problem from within the context of this project, because you can only ever view the page with the javascript when you’re authorised to create users; so it doesn’t make any difference. If this was public though, it could be a serious security risk. An example could be a comment form on a blog post, if you expose the method of creating a new comment through javascript then someone, with a little bit of work, could use the javascript to post automated comments.</p>

<p>Once again, nothing major but I think it is definitely something you should bare in mind when creating your pages. I guess the moral of this little story is don’t use Ajax for the sake of it and if you do use it make sure that the functions you are calling are harmless. Anything dealing with security should be left to post-backs but user experience improving features are fine - auto complete text boxes for example.</p>

 <a class="read-more" href="/writings/ajax-and-security">Read more &raquo;</a>
        </section>
        <footer class="post-meta">
            
            
            <time class="post-date" datetime="2006-01-10">
                10 Jan 2006
            </time>
        </footer>
    </article>

    

    <article class="post">
        <header class="post-header">
            <h2 class="post-title"><a href="/writings/prototype-periodicalexecuter-stop-javascript-function">Prototype PeriodicalExecuter.stop() JavaScript function</a></h2>
        </header>
        <section class="post-excerpt">
            <p>Download: <a href="#" title="Prototype extensions javascript file">prototype-extensions.js</a>. <em>(this download is no longer available, sorry)</em></p>

<p>I’ve been playing with the <a href="http://prototype.conio.net/">prototype framework</a> for a while now and am very impressed, the file size is a bit of a down point but that aside it’s excellent.</p>

<p>The one thing that has slightly irritated me (and <a href="http://roberthanson.blogspot.com/2005/11/prototypejs-periodicalexecuter.html" title=" Robert Hanson's Blog">others it seems</a>) is that there isn’t a stop function built into the PeriodicalExecuter object. Seems something strangly simple to miss out, especially as the Ajax.PeriodicalUpdater has one built in. With that in mind I’ve made an extension my self to perform this function.</p>

<p>I’ve simply placed the following code in a <a href="http://www.jagregory.com/downloads/prototype-extensions.js" title="Prototype extensions javascript file">prototype-extensions.js</a> file and referenced it wherever needed.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nx">PeriodicalExecuter</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">registerCallback</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">intervalID</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">onTimerEvent</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">),</span> <span class="k">this</span><span class="p">.</span><span class="nx">frequency</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">PeriodicalExecuter</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">stop</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">clearInterval</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">intervalID</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
</div>

<p>There’s really nothing much going on in this code, all it does is take the current registerCallback function (which creates the actual timer) and stores its returned interval ID which we then use in the new stop function with the native clearInterval method.</p>

<p>Here’s an example implementation where I fire the PeriodicalExecuter when a key is released in a text box and then stop it once the call completes, this was the main reason I created this extension, my aim was to have a waiting period of a few seconds before a ajax lookup is performed; mainly to cut down on server calls. Each time the textbox changes the PeriodicalExecuter gets reset and started again which means the function will only ever fire once the countdown is complete.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">id=</span><span class="s">"changer"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;</span>
  <span class="kd">var</span> <span class="nx">pe</span><span class="p">;</span>

  <span class="nx">$</span><span class="p">(</span><span class="s1">'changer'</span><span class="p">).</span><span class="nx">onkeyup</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">pe</span><span class="p">)</span> <span class="nx">pe</span><span class="p">.</span><span class="nx">stop</span><span class="p">();</span>
    <span class="nx">pe</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PeriodicalExecuter</span><span class="p">(</span><span class="nx">textChange</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">textChange</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">alert</span><span class="p">(</span><span class="s1">'check textbox content against database here'</span><span class="p">);</span>
    <span class="nx">pe</span><span class="p">.</span><span class="nx">stop</span><span class="p">();</span>
  <span class="p">}</span>
<span class="nt">&lt;/script&gt;</span>
</code></pre>
</div>

<p>I’m sure this method of extension is probably frowned upon from within the community and changes are expected to be submitted for the actual library, but I needed a fix asap and I’m sure a few other people might too.</p>

 <a class="read-more" href="/writings/prototype-periodicalexecuter-stop-javascript-function">Read more &raquo;</a>
        </section>
        <footer class="post-meta">
            
            
            <time class="post-date" datetime="2006-01-09">
                09 Jan 2006
            </time>
        </footer>
    </article>

    

    <article class="post">
        <header class="post-header">
            <h2 class="post-title"><a href="/writings/nested-datagridrepeater-with-key-value-access">Nested DataGrid/Repeater with Key Value access</a></h2>
        </header>
        <section class="post-excerpt">
            <p>One of my colleagues was having a problem with a datagrid nested in a repeater. We’ve done this kind of thing before with no problems, but this time the dataset wasn’t allowing key access to columns (i.e <code>Container.DataItem("ID")</code>). We toiled for quite some time trying to figure out why, with no avail. Eventually we just ended up using the direct index of the column; which worked fine as long as we didn’t change the column ordering.</p>

<pre><code class="language-aspx-vb">&lt;asp:Repeater id="rptLogins" Runat="server"&gt;
  &lt;ItemTemplate&gt;
    &lt;%# DataBinder.Eval(Container, "DataItem.Password") %&gt;

    &lt;asp:DataGrid id="dgUsageDetail" Runat="server" DataSource='%# Container.DataItem.Row.GetChildRows("myRelation") %&gt;' AutoGenerateColumns="false"&gt;
      &lt;Columns&gt;
        &lt;asp:TemplateColumn HeaderText="Date"&gt;
          &lt;ItemTemplate&gt;&lt;%# DataBinder.Eval(Container, "DataItem(1)", "{0:dd/MM/yyyy}") %&gt;&lt;/ItemTemplate&gt;
        &lt;/asp:TemplateColumn&gt;
        &lt;asp:TemplateColumn HeaderText="Time"&gt;
          &lt;ItemTemplate&gt;&lt;%# DataBinder.Eval(Container, "DataItem(1)", "{0:T}") %&gt;&lt;/ItemTemplate&gt;
        &lt;/asp:TemplateColumn&gt;
        &lt;asp:TemplateColumn HeaderText="Page Visited"&gt;
          &lt;ItemTemplate&gt;&lt;%# Container.DataItem(2) %&gt;&lt;/ItemTemplate&gt;
        &lt;/asp:TemplateColumn&gt;
      &lt;/Columns&gt;
    &lt;/asp:DataGrid&gt;
  &lt;/ItemTemplate&gt;
&lt;/asp:Repeater&gt;
</code></pre>

<p>I was never happy with this solution, for the above reason. In my opinion if you’re referencing columns you should never, ever reference them by index because it’s making your code reliant on the physical structure of the database. Something you may not have any control over what-so-ever.</p>

<p>Anyway, just now I was working on my own little project (…on my lunch) and I needed to do the same thing; perfect time for some investigation. If you look at the DataSource of the above nested datagrid you’ll see it’s bound to the current rows <code>GetChildRows</code> method, ends up (fairly obviously in hind sight) this returns a simple 1-dimensional array of DataRow objects. These DataRow objects (to my knowledge) basically contain an internal array of values, these values map to their parents <code>Columns</code> collection. There’s no reference to the actual name of the column, hence why the key access doesn’t work.</p>

<p>The solution is quite simple. So simple it’s unbelievable… Replace <code>Row.GetChildRows("myRelation")</code> with <code>Row.CreateChildView("myRelation")</code>. This creates a DataView object of the child rows, so essentially it’s a mini-dataset for you to deal with as if it were standard. Keyed referencing is back in action!</p>

<blockquote>
  <p>Note: For those that are wondering, a dataview isn’t actually a mini-dataset but a filtered view of its parent dataset.</p>
</blockquote>

 <a class="read-more" href="/writings/nested-datagridrepeater-with-key-value-access">Read more &raquo;</a>
        </section>
        <footer class="post-meta">
            
            
            <time class="post-date" datetime="2005-10-20">
                20 Oct 2005
            </time>
        </footer>
    </article>

    

    <article class="post">
        <header class="post-header">
            <h2 class="post-title"><a href="/writings/sql-server-exists-function-quicker-than-count">SQL Server: Exists() function quicker than Count()</a></h2>
        </header>
        <section class="post-excerpt">
            <p>You’ve seen the title; it’s true.</p>

<p>I’ve been running an “administration” query to modify a table with around 190,000 records in. This table, segments, contains a status column called Coded. This value is derived from another table, faults. If any faults belonging to a segment has a coded status of 0 then the segment coded value is also 0.</p>

<p>My query did an update on each row in the segments table, retrieving a <code class="highlighter-rouge">count</code> of how many faults there are with a coded status of <code class="highlighter-rouge">0</code> that belong to the current segment. If the <code class="highlighter-rouge">count</code> is greater than <code class="highlighter-rouge">0</code> then the segment coded is set to <code class="highlighter-rouge">0</code>, otherwise to <code class="highlighter-rouge">1</code>.</p>

<p>It ran for over 2 hours without any sign of finishing.</p>

<p>I changed the query to do a simple case statement with an <code class="highlighter-rouge">exists</code> on the faults table where <code class="highlighter-rouge">Coded = 0</code> and it’s just finished in 4 minutes. Unbelievable.</p>

<h3 id="update">Update</h3>

<p>I thought I should give a bit of an explanation as to why this is happening. It basically all boils down to the way the two functions operate that makes the biggest difference. A <code class="highlighter-rouge">count</code> statement counts every row that matches the where statement, so even if you only need to know about one record (like in my case) it’ll still read every other row too. On the other hand the <code class="highlighter-rouge">exists</code> function will return as soon as its conditions are met, so if the first row it finds matches it’ll only read one row.</p>

 <a class="read-more" href="/writings/sql-server-exists-function-quicker-than-count">Read more &raquo;</a>
        </section>
        <footer class="post-meta">
            
            
            <time class="post-date" datetime="2005-09-22">
                22 Sep 2005
            </time>
        </footer>
    </article>

    

    <article class="post">
        <header class="post-header">
            <h2 class="post-title"><a href="/writings/datediff-minus-one-visualbasic-assembly">DateDiff() minus one VisualBasic assembly</a></h2>
        </header>
        <section class="post-excerpt">
            <p>I’m not a big fan of using the <code class="highlighter-rouge">Microsoft.VisualBasic</code> assembly, I avoid it at all costs basically.</p>

<p>As we all know, the visual basic assembly comes with a large collection of built-in functions one of which is the <code class="highlighter-rouge">DateDiff</code> function. This takes two dates and a comparison value (e.g. <code class="highlighter-rouge">d</code> for day) and then spits out the difference.</p>

<p>Here’s the same thing just minus the visual basic usage:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">DateTime</span> <span class="n">firstDate</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">Now</span><span class="p">;</span>
<span class="n">DateTime</span> <span class="n">secondDate</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">DateTime</span><span class="p">(</span><span class="m">2005</span><span class="p">,</span> <span class="m">8</span><span class="p">,</span> <span class="m">20</span><span class="p">);</span>
<span class="n">TimeSpan</span> <span class="n">difference</span> <span class="p">=</span> <span class="n">secondDate</span><span class="p">.</span><span class="nf">Subtract</span><span class="p">(</span><span class="n">firstDate</span><span class="p">);</span>

<span class="c1">// days: difference.Days
</span></code></pre>
</div>

 <a class="read-more" href="/writings/datediff-minus-one-visualbasic-assembly">Read more &raquo;</a>
        </section>
        <footer class="post-meta">
            
            
            <time class="post-date" datetime="2005-09-16">
                16 Sep 2005
            </time>
        </footer>
    </article>

    

    <nav class="pagination" role="pagination">
    
        
            <a class="newer-posts" href="/page19/" title="Previous Page">&laquo; Newer Posts</a>
      
    
    <span class="page-number"> Page 20 of 23 </span>
     
        <a class="older-posts" href="/page21/" title="Next Page">Older Posts &raquo;</a>
     
</nav>

</main>

    <footer class="site-footer clearfix">
      <section class="copyright">
        <a href="mailto:james@jagregory.com">James Gregory</a> &copy;
               &bull; All content licensed under <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">cc by-nc-sa 4.0</a>.
      </section>
    </footer>

    <script type="text/javascript" src="/js/jquery-1.11.1.min.js"></script>
    <script type="text/javascript" src="/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="/js/index.js"></script>
</body>
</html>
