<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

    <title>James Gregory</title>
    <meta name="description" content="Code monkey. ThoughtWorks. Chief Agitator.
" />

    <meta name="HandheldFriendly" content="True" />
    <meta name="MobileOptimized" content="320" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" type="text/css" href="/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400" />
    <!-- Customisation  -->
    <link rel="stylesheet" type="text/css" href="/css/main.css" />

</head>
<body class="home-template">

    <header class="main-header no-cover">
    <div class="vertical">
        <div class="main-header-content inner">
            <h1 class="page-title"><a href="/">James Gregory</a></h1>
            <h2 class="page-description">
                 Code monkey. ThoughtWorks. Chief Agitator.
 
            </h2>
        </div>
    </div>
    <a class="scroll-down icon-arrow-left" href="#content" data-offset="-45"><span class="hidden">Scroll Down</span></a>
</header>

<main id="content" class="content" role="main">
    <div class="extra-pagination inner">
        <nav class="pagination" role="pagination">
    
        
            <a class="newer-posts" href="/page12/" title="Previous Page">&laquo; Newer Posts</a>
      
    
    <span class="page-number"> Page 13 of 23 </span>
     
        <a class="older-posts" href="/page14/" title="Next Page">Older Posts &raquo;</a>
     
</nav>
    </div>

    

    <article class="post">
        <header class="post-header">
            <h2 class="post-title"><a href="/writings/all-about-dependencies">All about dependencies</a></h2>
        </header>
        <section class="post-excerpt">
            <blockquote>
  <p>This article serves as an introduction to the concept of <a href="http://martinfowler.com/articles/injection.html">Dependency Injection</a>, and why you’d want to use it. It is not a getting started guide for using containers. If you’re interested in those, my personal preference is <a href="http://www.castleproject.org/container/">Castle Windsor</a> and you can find their <a href="http://www.castleproject.org/container/gettingstarted/index.html">getting started guide here</a>.</p>
</blockquote>

<p>What are dependencies? Also referred to as couplings, dependencies are other modules that one module requires to fulfil it’s purpose.</p>

<p>Are dependencies bad? No, of course they’re not, otherwise we wouldn’t be able to create anything. However, highly coupled code can cause a lot of problems for your application.</p>

<p>If your code requires knowledge of how a dependency works, then your code is highly coupled. If your code is tied explicitly to an implementation, then your code is also highly coupled.</p>

<p>Take the following example:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">ProductUpdater</span>
<span class="p">{</span>
	<span class="k">public</span> <span class="k">void</span> <span class="nf">StoreChanges</span><span class="p">(</span><span class="n">Product</span> <span class="n">product</span><span class="p">)</span>
	<span class="p">{</span>
	  <span class="n">SqlDataStore</span> <span class="n">dataStore</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SqlDataStore</span><span class="p">();</span>

	  <span class="n">dataStore</span><span class="p">.</span><span class="nf">CreateConnection</span><span class="p">();</span>
	  <span class="n">dataStore</span><span class="p">.</span><span class="nf">OpenConnection</span><span class="p">();</span>

	  <span class="n">dataStore</span><span class="p">.</span><span class="nf">Update</span><span class="p">(</span><span class="n">product</span><span class="p">);</span>

	  <span class="n">dataStore</span><span class="p">.</span><span class="nf">CloseConnection</span><span class="p">();</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<p>The above example is highly coupled to the <code>SqlDataStore</code>. Firstly, it directly creates an instance, which means there’s no way for us to replace that instance if we need to (I’ll come to why you’d want to do that in a bit). Secondly, it relies on a great deal of knowledge of <code>SqlDataStore</code>’s implementation. In this code we can see that you need to create a connection and open it before you can update the record; that’s quite a bit of implementation knowledge. If the <code>SqlDataStore</code> was to change so that the <code>OpenConnection</code> method created a connection if one didn’t already exist, then we’d need to change every caller of  that code to remove the <code>CreateConnection</code> call; in large system situations like that can quickly lead to a fear of change and refactoring.</p>

<p>I mentioned directly creating an instance stops us from replacing it if need be.  Well when would you actually want to do this? For those unfamiliar with unit testing, you probably haven’t encountered <a href="http://www.martinfowler.com/bliki/TestDouble.html">test doubles</a>; there are different types of test doubles, but for the purposes of this example they’re interchangeable.</p>

<p>A test double serves as a swap-in replacement for one of your dependencies. These allow you to execute a piece of code under test, without having to worry about whether things are being put in your database, or e-mails sent for example. If your code is creating instances within methods, those instances cannot be replaced by a test double. Without that ability, testing becomes considerably more difficult.</p>

<p>Tightly tying your code to an instance of a class reduces the flexibility and reuse of your code. Take the above example, that same code could be used to update the product in a cache instead of the database; similarly, you could use an in-memory storage instead of a database for when you’re running in a test or demo environment. If only your method wasn’t so tightly tied to the implementation.</p>

<p>This is solved by using <a href="http://martinfowler.com/articles/injection.html">Dependency Injection</a>, which is a part of the &lt;a href=”http://en.wikipedia.org/wiki/Dependency_inversion_principle”Dependency Inversion Principal&lt;/a&gt; and <a href="http://en.wikipedia.org/wiki/Inversion_of_Control">Inversion of Control</a>.</p>

<blockquote>
  <p>[DIP] seeks to “invert” the conventional notion that high level modules in software should depend upon the lower level modules. The principle states that high level or low level modules should not depend upon each other, instead they should depend upon abstractions. – Wikipedia</p>
</blockquote>

<p>Essentially, dependency injection allows you to stop instantiating your dependencies. Instead they’re “injected” into your object when it is instantiated itself. This allows the dependencies to be swapped out like we mentioned above.</p>

<p>So taking the original example, here’s a version of it that’s been updated to use dependency injection.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">ProductUpdater</span>
<span class="p">{</span>
	<span class="k">private</span> <span class="n">SqlDataStore</span> <span class="n">dataStore</span><span class="p">;</span>
	
	<span class="k">public</span> <span class="nf">ProductUpdater</span><span class="p">(</span><span class="n">SqlDataStore</span> <span class="n">dataStore</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">this</span><span class="p">.</span><span class="n">dataStore</span> <span class="p">=</span> <span class="n">dataStore</span><span class="p">;</span>
	<span class="p">}</span>
	
	<span class="k">public</span> <span class="k">void</span> <span class="nf">StoreChanges</span><span class="p">(</span><span class="n">Product</span> <span class="n">product</span><span class="p">)</span>
	<span class="p">{</span>
	  <span class="n">dataStore</span><span class="p">.</span><span class="nf">CreateConnection</span><span class="p">();</span>
	  <span class="n">dataStore</span><span class="p">.</span><span class="nf">OpenConnection</span><span class="p">();</span>

	  <span class="n">dataStore</span><span class="p">.</span><span class="nf">Update</span><span class="p">(</span><span class="n">product</span><span class="p">);</span>

	  <span class="n">dataStore</span><span class="p">.</span><span class="nf">CloseConnection</span><span class="p">();</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<p>The above implementation now allows us to create a test double, and replace the <code>SqlDataStore</code> in our tests. As I mentioned before, we could now easily push in an in-memory implementation without any changes to the code required.</p>

<p>We can take this further though, because we’re still tied to a concrete class. Lets make <code>SqlDataStore</code> implement an interface, so we can create other implementations.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">public</span> <span class="k">interface</span> <span class="n">IDataStore</span>
<span class="p">{</span>
	<span class="k">void</span> <span class="nf">CreateConnection</span><span class="p">();</span>
	<span class="k">void</span> <span class="nf">OpenConnection</span><span class="p">();</span>
	<span class="k">void</span> <span class="nf">Update</span><span class="p">(</span><span class="n">Product</span> <span class="n">product</span><span class="p">);</span>
	<span class="k">void</span> <span class="nf">CloseConnection</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">ProductUpdater</span>
<span class="p">{</span>
	<span class="k">private</span> <span class="n">IDataStore</span> <span class="n">dataStore</span><span class="p">;</span>
	
	<span class="k">public</span> <span class="nf">ProductUpdater</span><span class="p">(</span><span class="n">IDataStore</span> <span class="n">dataStore</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">this</span><span class="p">.</span><span class="n">dataStore</span> <span class="p">=</span> <span class="n">dataStore</span><span class="p">;</span>
	<span class="p">}</span>
	
	<span class="k">public</span> <span class="k">void</span> <span class="nf">StoreChanges</span><span class="p">(</span><span class="n">Product</span> <span class="n">product</span><span class="p">)</span>
	<span class="p">{</span>
	  <span class="n">dataStore</span><span class="p">.</span><span class="nf">CreateConnection</span><span class="p">();</span>
	  <span class="n">dataStore</span><span class="p">.</span><span class="nf">OpenConnection</span><span class="p">();</span>

	  <span class="n">dataStore</span><span class="p">.</span><span class="nf">Update</span><span class="p">(</span><span class="n">product</span><span class="p">);</span>

	  <span class="n">dataStore</span><span class="p">.</span><span class="nf">CloseConnection</span><span class="p">();</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<p>Now our example is no longer specifically tied to a <code>SqlDataStore</code>, so we could quite easily pass it a <code>FileSystemDataStore</code>, or an <code>InMemoryDataStore</code>, or anything else that implements <code>IDataStore</code>. All that without having to touch a single line within the <code>ProductUpdater</code>.</p>

<p>That’s the power of dependency injection, and why you should stop hard-coding your dependencies.</p>

 <a class="read-more" href="/writings/all-about-dependencies">Read more &raquo;</a>
        </section>
        <footer class="post-meta">
            
            
            <time class="post-date" datetime="2008-04-05">
                05 Apr 2008
            </time>
        </footer>
    </article>

    

    <article class="post">
        <header class="post-header">
            <h2 class="post-title"><a href="/writings/static-method-abuse">Static method abuse</a></h2>
        </header>
        <section class="post-excerpt">
            <p>I dislike static methods, there I said it.</p>

<p>Like everything, they have their place; but as the old analogy says, when you have a hammer everything looks like a nail. <strong>Static methods are being abused.</strong></p>

<h2 id="dont-make-me-instantiate">Don’t make me instantiate</h2>

<p>For some reason programmers seem to be allergic to instantiating objects, to the point of where half the functionality is implemented in static classes and methods. You can go for days without seeing an instance in my current project’s code-base.</p>

<p>I think it’s symptomatic of a bigger problem. If you think creating instances is wasteful, maybe you’re creating too many. You’re most likely violating the Single Responsibility Principal (SRP) or Separation of Concerns (SoC). Too many dependencies usually means your class is trying to do too much, get it spit-up, and get it clean.</p>

<h2 id="state-vs-stateless">State vs. stateless</h2>

<p>One justification for using static methods that is often touted around is that if a method doesn’t have any state, then it should be static. To me this is a fallacy, because state isn’t everything. Take the following repository example:</p>

<h3 id="using-static-methods">Using static methods</h3>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">Customer</span> <span class="n">customer</span> <span class="p">=</span> <span class="n">Repository</span><span class="p">&lt;</span><span class="n">Customer</span><span class="p">&gt;.</span><span class="nf">FindByID</span><span class="p">(</span><span class="m">102</span><span class="p">);</span>

<span class="n">customer</span><span class="p">.</span><span class="n">Name</span> <span class="p">=</span> <span class="s">"James"</span><span class="p">;</span>

<span class="n">Repository</span><span class="p">&lt;</span><span class="n">Customer</span><span class="p">&gt;.</span><span class="nf">Save</span><span class="p">(</span><span class="n">customer</span><span class="p">);</span>
</code></pre>
</div>

<h3 id="using-an-instance">Using an instance</h3>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">IRepository</span><span class="p">&lt;</span><span class="n">Customer</span><span class="p">&gt;</span> <span class="n">repos</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Repository</span><span class="p">&lt;</span><span class="n">Customer</span><span class="p">&gt;();</span>

<span class="n">Customer</span> <span class="n">customer</span> <span class="p">=</span> <span class="n">repos</span><span class="p">.</span><span class="nf">FindByID</span><span class="p">(</span><span class="m">102</span><span class="p">);</span>

<span class="n">customer</span><span class="p">.</span><span class="n">Name</span> <span class="p">=</span> <span class="s">"James"</span><span class="p">;</span>

<span class="n">repos</span><span class="p">.</span><span class="nf">Save</span><span class="p">(</span><span class="n">customer</span><span class="p">);</span>
</code></pre>
</div>

<p>Noticably the first example is one line less than the second. However, it’s compromising readability in removing that line. Instead of using the <code>repos</code> instance, you’re forced to fully-qualify every method call with <code>Repository<customer>&lt;/code&gt;, which is introducing more noise per-line.</customer></code></p>

<p>Even though the methods <code>FindByID</code> and <code>Save</code> don’t have any shared state, they both form a part of the encapsulation of data-access (in this case).</p>

<blockquote>
  <p>If a method forms a key part of an encapsulation, then it shouldn’t be static.</p>
</blockquote>

<p>When you make the decision of creating a static method due to it being stateless, you’re revealing more implementation details than necessary. A big part of encapsulation is hiding implementation details from the consumer.</p>

<p>While the methods are stateless, they might not always be that way; perhaps the repository could share a session between calls in the future. With an instance based design, you won’t have any problems. Try introducing state into a static method, and things either get very messy, or you end up converting everything to instances and having to rewrite any usages.</p>

<blockquote>
  <p>Static methods tie you in at an early stage to a specific design, making it very difficult to refactor out later.</p>
</blockquote>

<h2 id="not-all-bad">Not all bad</h2>

<p>So where are the good static methods? <em>The <code>Math</code> class is a good example</em>. It contains a set of functions that are only loosely related (apart from being mathematical), that are guaranteed to be stateless, and most importantly are simple. Architecturally the methods in the <code>Math</code> class could be applied to a wide swath of objects (<code>int</code>, <code>float</code>, <code>double</code>, <code>decimal</code> etc…) and to have them as instance methods would complicate the class hierarchy more than it would benefit it.</p>

<blockquote>
  <p>Static methods should be fire-and-forget, disposable, simple, and effective.</p>
</blockquote>

<h2 id="object-orientation">Object-orientation</h2>

<p>Static methods aren’t associated with an object, they’re tied to a type. This is a big distinction. People are under the belief that because statics sit in the same class definition as instance methods, that it makes them object-oriented.</p>

<p>Two key points of object-oriented design that static methods violate are inheritance and polymorphism. The inability to substitute a method with an implementation in a derived class is pretty unforgivable, and heavily restricting.</p>

<h2 id="finally-testing">Finally, testing</h2>

<p>The argument that you’re most likely to encounter against using static methods is that of testing. It’s certainly one that I agree with, I just didn’t want it to seem like that’s the main reason of my argument.</p>

<p>Statics are bad for testing because they can’t be substituted easily. A major part of unit testing is being able to isolate what you’re testing from it’s dependencies; isolation allows you to verify one part of the system at a time. Static methods aren’t overridable in a sub-class, and so they aren’t mockable either (without the use of TypeMock).</p>

<p>Of the two examples used above, in the first example it would be very hard to test that code without actually going to the database, because of the ties to the static methods. The second example could be refactored so the IRepository dependency is injected, and thus replaceable at test time.</p>

<p>Not being able to test in isolation is the final nail in the coffin for static methods and me.</p>

 <a class="read-more" href="/writings/static-method-abuse">Read more &raquo;</a>
        </section>
        <footer class="post-meta">
            
            
            <time class="post-date" datetime="2008-03-28">
                28 Mar 2008
            </time>
        </footer>
    </article>

    

    <article class="post">
        <header class="post-header">
            <h2 class="post-title"><a href="/writings/plug-ins-and-browsers">Plug-in's and browsers</a></h2>
        </header>
        <section class="post-excerpt">
            <p>Jeff Atwood (of <a href="http://www.codinghorror.com">Coding Horror</a>) <a href="http://twitter.com/codinghorror/statuses/778279263">tweeted earlier</a>: “On Firefox: ‘add-ons aren’t a big draw for me – I just need a browser, not a circus.’”. I don’t know whether this was a quotation of himself, or someone else; but it’s something that I’ve heard mentioned before.</p>

<p>Just because they’re there, doesn’t mean you have to install them.</p>

<p>A plug-in model in your browser allows you to install as many, or as few, plug-ins as you need. A lot of them are useless, but if there’s one that can boost your productivity, isn’t that worth it? I’d rather have a browser with a plug-in model, and one really useful plug-in, than a browser without both.</p>

<p>A prime example is FireBug, I couldn’t live without that plug-in. I feel stranded in IE or Safari when it comes to interrogating pages.</p>

<p>FireBug possibly highlights a hole in the developer support from the Firefox development team itself, but with a plug-in model you can fill that hole yourself rather than relying on their team; like we’ve had to do for years with Microsoft and Internet Explorer.</p>

<p>/rant off</p>

 <a class="read-more" href="/writings/plug-ins-and-browsers">Read more &raquo;</a>
        </section>
        <footer class="post-meta">
            
            
            <time class="post-date" datetime="2008-03-28">
                28 Mar 2008
            </time>
        </footer>
    </article>

    

    <article class="post">
        <header class="post-header">
            <h2 class="post-title"><a href="/writings/getfilename-nant-task">getfilename NAnt task</a></h2>
        </header>
        <section class="post-excerpt">
            <p>As part of my current quest to fully automate our build, I found my self needing the ability to copy a database backup from our remote server. The backup is in a folder along with several other backups, with a filename based on the date. I didn’t fancy trying to programmatically guess the filename, so I wrote an NAnt task to grab the newest file in a directory. Thanks to <a href="http://blogs.geekdojo.net/rcase">Richard Case</a> for his overview of how to <a href="http://blogs.geekdojo.net/rcase/archive/2005/01/06/5971.aspx">create a custom NAnt task</a>.</p>

<p>The <code class="highlighter-rouge">getfilename</code> task simply gets the filename of a file in a directory, then pushes the name into the specified property. The filename to find can be based on the creation date, last modified date etc…</p>

<p>The attributes are as follows:</p>

<table class="format-table">
	<thead>
		<tr>
			<th>Attribute</th>
			<th>Description</th>
			<th>Required</th>
		</tr>
	</thead>
	<tbody>
		<tr>
			<td>in</td>
			<td>The directory to search</td>
			<td>Yes</td>
		</tr>
		<tr class="alt">
			<td>property</td>
			<td>The property to push the filename into.</td>
			<td>Yes</td>
		</tr>
		<tr>
			<td>searchPattern</td>
			<td>Wildcard search pattern for finding the file.</td>
			<td>No</td>
		</tr>
		<tr class="alt">
			<td>of</td>
			<td>
				The file to get the filename of.<br /><br />
				<strong>NewestFile</strong> - The most recently created file<br />
				<strong>OldestFile</strong> - The oldest file in the directory<br />
				<strong>FirstModifiedFile</strong> - The file with the oldest last modified date<br />
				<strong>LastModifiedFile</strong> - The most recently modified file<br />
				<strong>FirstFile</strong> - The first file in the directory, using default sorting<br />
				<strong>LastFile</strong> - The last file in the directory, using default sorting<br />
			</td>
			<td>No - Defaults to NewestFile</td>
		</tr>
	</tbody>
</table>

<p>An example usage is:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0"?&gt;</span>
<span class="nt">&lt;project</span> <span class="na">name=</span><span class="s">"Example"</span> <span class="na">default=</span><span class="s">"run"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;target</span> <span class="na">name=</span><span class="s">"run"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;getfilename</span> <span class="na">of=</span><span class="s">"NewestFile"</span> <span class="na">in=</span><span class="s">"C:\path\to\backups"</span> <span class="na">searchPattern=</span><span class="s">"*.bak"</span> <span class="na">property=</span><span class="s">"filename"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;echo</span> <span class="na">message=</span><span class="s">"Filename: ${filename}"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/target&gt;</span>
<span class="nt">&lt;/project&gt;</span>
</code></pre>
</div>

<p>Foreseeable usage situations revolve around anything where you’d need to get the last modified, or newest file in a directory; backups, database scripts etc…</p>

<h2 id="downloads">Downloads</h2>

<p>The DeleGrid is open-source under the <a href="http://en.wikipedia.org/wiki/BSD_license">new BSD License</a>; read the license for what you’re allowed to do.</p>

<p>You can download the source here: <a href="http://jagregory.googlecode.com/files/JAGregory.NAntTasks-1.0-source.zip">Download Source</a>.<br />
You can download the latest binary here: <a href="http://jagregory.googlecode.com/files/JAGregory.NAntTasks-1.0.zip">Download Binary</a>.</p>

<p>The source is also accessible from Subversion at: <a href="http://jagregory.googlecode.com/svn/trunk/JAGregory.NAntTasks/">http://jagregory.googlecode.com/svn/trunk/JAGregory.NAntTasks/</a> (using user jagregory-read-only)</p>

 <a class="read-more" href="/writings/getfilename-nant-task">Read more &raquo;</a>
        </section>
        <footer class="post-meta">
            
            
            <time class="post-date" datetime="2008-03-12">
                12 Mar 2008
            </time>
        </footer>
    </article>

    

    <article class="post">
        <header class="post-header">
            <h2 class="post-title"><a href="/writings/introducing-the-filterable-delegrid">Introducing the filterable DeleGrid</a></h2>
        </header>
        <section class="post-excerpt">
            <p>The DeleGrid is a paged GridView control that handles data-binding through the use of events and delegates rather than with a traditional collection.</p>

<p>What this means is that you have full control over the data that is shown in the currently displayed page. Traditionally you’d retrieve the whole recordset then page it locally, but with the DeleGrid you can utilise your database/ORMs paging features.</p>

<p>To quote myself from when I first <a href="/writings/delegrid/">introduced the DeleGrid</a>:</p>

<blockquote>
  <p>[The DeleGrid] came about because I wanted a nice way of implementing paging using NHibernate without having the grid know about it. I really didn’t want NHibernate to leave my data layer, so I needed a nice way of the grid calling my DAL with the paging parameters.</p>
</blockquote>

<h2 id="whats-new">What’s new?</h2>

<p>The biggest change in version 1.1 is the introduction of filtering. The filter isn’t generated in some black-box fashion, instead it’s defined by the programmer. It’s built up from the columns in the grid, which define their own filtering behaviour.</p>

<p>The filter acts upon any columns in the grid that implement the IFilterableField interface. Implementing this interface in your own fields is easy, so you’re quickly able to create custom filtering behavior for your grid. An example would be a date column, that has a date-picker as a filter control.</p>

<p><img src="/images/fd-1.png" alt="Filter Screenshot" /></p>

<p>I’ve chosen not to implement the wealth of appearance customisations that are available in the normal templated controls. This is down to two reasons, firstly I don’t agree with it, appearance should be controlled solely through CSS. Secondly, there are so many, I couldn’t be bothered. So you’re only able to attach CSS classes to the buttons and cells, and specify the image urls for the buttons.</p>

<h2 id="an-example-implementation">An example implementation</h2>

<p>The grid now has a companion project, it’s own data library. This separation is to keep you from having to reference System.Web in your data-layer. To use the DeleGrid in your project you’ll need to reference <code class="highlighter-rouge">JAGregory.Controls.DeleGrid.dll</code> and the <code class="highlighter-rouge">JAGregory.Controls.Data.dll</code> in your web project, then reference <code class="highlighter-rouge">JAGregory.Controls.Data.dll</code> in your data layer, if they’re separate projects.</p>

<p>So to begin with, add the reference to <code class="highlighter-rouge">JAGregory.Controls.DeleGrid.dll</code> and <code class="highlighter-rouge">JAGregory.Controls.Data.dll</code> into your web project. This will allow you to use the DeleGrid in your page. Once you’ve done that, you’ll need to reference the control in your page, you can either do this using a Register tag in your page, or in the web.config as so:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;pages&gt;</span>
  <span class="nt">&lt;controls&gt;</span>
    <span class="nt">&lt;add</span> <span class="na">tagPrefix=</span><span class="s">"jag"</span> <span class="na">namespace=</span><span class="s">"JAGregory.Controls"</span>
      <span class="na">assembly=</span><span class="s">"JAGregory.Controls.DeleGrid"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/controls&gt;</span>
<span class="nt">&lt;/pages&gt;</span>
</code></pre>
</div>

<p>With that in place, you can now put the DeleGrid into your page:</p>

<pre><code class="language-aspx-cs">&lt;jag:DeleGrid ID="grid" Runat="server" AllowFiltering="true"
  AutoGenerateColumns="false"&gt;
    &lt;FilterStyle ToggleOnImageUrl="img/find.png" ToggleOffImageUrl="img/find.png"
      ExecuteImageUrl="img/go.png" /&gt;
    &lt;Columns&gt;
        &lt;jag:FilterableTextField HeaderText="Name" DataField="Name" /&gt;
        &lt;jag:FilterableBooleanField HeaderText="Active" DataField="Active" /&gt;
    &lt;/Columns&gt;
&lt;/jag:DeleGrid&gt;
</code></pre>

<p>In this example I’m using a Customer object to bind against it, which simply has the Name and Active properties.</p>

<p>For this grid we’ve set AllowFiltering to true, which enables the filter, then we’ve set AutoGenerateColumns to false so we can add our own custom columns. The two columns both implement the aforementioned IFilterableField interface, which allows them to define their own filtering behaviour.</p>

<p>I’ve also set the image urls so the buttons will be visible.</p>

<p>Now that the page is set up, we need to get down to the binding. In your code-behind:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">OnInit</span><span class="p">(</span><span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">base</span><span class="p">.</span><span class="nf">OnInit</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>

  <span class="c1">// attach the events for requesting the data and totals
</span>  <span class="n">grid</span><span class="p">.</span><span class="n">TotalRecordCountRequest</span> <span class="p">+=</span> <span class="n">grid_TotalRecordCountRequest</span><span class="p">;</span>
  <span class="n">grid</span><span class="p">.</span><span class="n">PageDataRequest</span> <span class="p">+=</span> <span class="n">grid_PageDataRequest</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">OnLoad</span><span class="p">(</span><span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">base</span><span class="p">.</span><span class="nf">OnLoad</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(!</span><span class="n">IsPostBack</span><span class="p">)</span>
    <span class="n">grid</span><span class="p">.</span><span class="nf">DataBind</span><span class="p">();</span>
<span class="p">}</span>
</code></pre>
</div>

<p>What’ve just done is attach the TotalRecordCountRequest and PageDataRequest handlers to the grid, which respectively fetch the total record count for the full grid, and fetch the current page of data from the database; the implementations are below.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">private</span> <span class="n">IEnumerable</span> <span class="nf">grid_PageDataRequest</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">PageDataRequestEventArgs</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">CustomerRepository</span> <span class="n">repos</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">CustomerRepository</span><span class="p">();</span>

  <span class="c1">// get the requested page of data from the database
</span>  <span class="k">return</span> <span class="n">repos</span><span class="p">.</span><span class="nf">FindAllPaged</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">Range</span><span class="p">,</span> <span class="n">e</span><span class="p">.</span><span class="n">Sort</span><span class="p">,</span> <span class="n">e</span><span class="p">.</span><span class="n">Filters</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">private</span> <span class="kt">int</span> <span class="nf">grid_TotalRecordCountRequest</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">DataRequestEventArgs</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">CustomerRepository</span> <span class="n">repos</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">CustomerRepository</span><span class="p">();</span>

  <span class="c1">// get the total records
</span>  <span class="k">return</span> <span class="n">repos</span><span class="p">.</span><span class="nf">GetAllCount</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">Filters</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
</div>

<p>I’m using a <a href="http://www.martinfowler.com/eaaCatalog/repository.html">repository pattern</a> to handle data-access. In the PageDataRequest handler we’re taking the range, sort, and filter info that the grid passed us and sending it off to the repository to get the data. Similarity the TotalRecordCountRequest handler does a similar thing but without the range or sort info.</p>

<p>That’s it really for using the DeleGrid, you just need to take the filter info and handle it using your specific ORM.</p>

<h2 id="repository-implementation">Repository implementation</h2>

<p>Ok I’ll throw you a bone, here’s the repository implementation to show how easy it is using NHibernate:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">CustomerRepository</span>
<span class="p">{</span>
  <span class="c1">/// &lt;summary&gt;
</span>  <span class="c1">/// Creates a NHibernate ICriteria based on the filters.
</span>  <span class="c1">/// &lt;/summary&gt;
</span>  <span class="c1">/// &lt;param name="filters"&gt;Filters to apply.&lt;/param&gt;
</span>  <span class="c1">/// &lt;returns&gt;ICriteria&lt;/returns&gt;
</span>  <span class="k">private</span> <span class="n">ICriteria</span> <span class="nf">CreateFilteredCriteria</span><span class="p">(</span><span class="n">FilterCriterionCollection</span> <span class="n">filters</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">ICriteria</span> <span class="n">criteria</span> <span class="p">=</span> <span class="n">SessionManager</span><span class="p">.</span><span class="n">CurrentSession</span>
      <span class="p">.</span><span class="nf">CreateCriteria</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">Customer</span><span class="p">));</span>

    <span class="c1">// criterion handling - write this yourself depending on how your
</span>    <span class="c1">// db filters (and what filter types you're supporting)
</span>    <span class="k">foreach</span> <span class="p">(</span><span class="n">FilterCriterion</span> <span class="n">filter</span> <span class="k">in</span> <span class="n">filters</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">filter</span><span class="p">.</span><span class="n">Type</span> <span class="p">==</span> <span class="k">typeof</span><span class="p">(</span><span class="kt">string</span><span class="p">))</span>
        <span class="n">criteria</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">Expression</span><span class="p">.</span><span class="nf">Like</span><span class="p">(</span><span class="n">filter</span><span class="p">.</span><span class="n">FieldName</span><span class="p">,</span> <span class="s">"%"</span> <span class="p">+</span> <span class="n">filter</span><span class="p">.</span><span class="n">Value</span> <span class="p">+</span> <span class="s">"%"</span><span class="p">));</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">filter</span><span class="p">.</span><span class="n">Type</span> <span class="p">==</span> <span class="k">typeof</span><span class="p">(</span><span class="kt">bool</span><span class="p">))</span>
        <span class="n">criteria</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">Expression</span><span class="p">.</span><span class="nf">Eq</span><span class="p">(</span><span class="n">filter</span><span class="p">.</span><span class="n">FieldName</span><span class="p">,</span> <span class="n">filter</span><span class="p">.</span><span class="n">Value</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">criteria</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">/// &lt;summary&gt;
</span>  <span class="c1">/// Gets the total record count from the database using the filters.
</span>  <span class="c1">/// &lt;/summary&gt;
</span>  <span class="c1">/// &lt;param name="filters"&gt;Filters to apply before getting the count.&lt;/param&gt;
</span>  <span class="c1">/// &lt;returns&gt;Total number of records in the filtered list&lt;/returns&gt;
</span>  <span class="k">public</span> <span class="kt">int</span> <span class="nf">GetAllCount</span><span class="p">(</span><span class="n">FilterCriterionCollection</span> <span class="n">filters</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">return</span> <span class="nf">CreateFilteredCriteria</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span>
      <span class="p">.</span><span class="nf">SetProjection</span><span class="p">(</span><span class="n">Projections</span><span class="p">.</span><span class="nf">Count</span><span class="p">(</span><span class="s">"ID"</span><span class="p">))</span>
      <span class="p">.</span><span class="n">UniqueResult</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;();</span>
  <span class="p">}</span>

  <span class="c1">/// &lt;summary&gt;
</span>  <span class="c1">/// Gets one page of data from the database.
</span>  <span class="c1">/// &lt;/summary&gt;
</span>  <span class="c1">/// &lt;param name="range"&gt;Select range (start ID and number of records).&lt;/param&gt;
</span>  <span class="c1">/// &lt;param name="sort"&gt;Sorting to apply.&lt;/param&gt;
</span>  <span class="c1">/// &lt;param name="filters"&gt;Filters to apply.&lt;/param&gt;
</span>  <span class="c1">/// &lt;returns&gt;List for one page of data.&lt;/returns&gt;
</span>  <span class="k">public</span> <span class="n">IList</span><span class="p">&lt;</span><span class="n">Customer</span><span class="p">&gt;</span> <span class="nf">FindAllPaged</span><span class="p">(</span><span class="n">SelectRange</span> <span class="n">range</span><span class="p">,</span> <span class="n">SortInfo</span> <span class="n">sort</span><span class="p">,</span> <span class="n">FilterCriterionCollection</span> <span class="n">filters</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="c1">// create the criteria using the filters, then set the range
</span>    <span class="n">ICriteria</span> <span class="n">criteria</span> <span class="p">=</span> <span class="nf">CreateFilteredCriteria</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span>
      <span class="p">.</span><span class="nf">SetFirstResult</span><span class="p">(</span><span class="n">range</span><span class="p">.</span><span class="n">Start</span><span class="p">)</span>
      <span class="p">.</span><span class="nf">SetMaxResults</span><span class="p">(</span><span class="n">range</span><span class="p">.</span><span class="n">Size</span><span class="p">);</span>

    <span class="c1">// only add the sort if one is specified
</span>    <span class="k">if</span> <span class="p">(!</span><span class="kt">string</span><span class="p">.</span><span class="nf">IsNullOrEmpty</span><span class="p">(</span><span class="n">sort</span><span class="p">.</span><span class="n">Field</span><span class="p">))</span>
    <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">sort</span><span class="p">.</span><span class="n">Direction</span> <span class="p">==</span> <span class="n">Direction</span><span class="p">.</span><span class="n">Asc</span><span class="p">)</span>
        <span class="n">criteria</span><span class="p">.</span><span class="nf">AddOrder</span><span class="p">(</span><span class="n">Order</span><span class="p">.</span><span class="nf">Asc</span><span class="p">(</span><span class="n">sort</span><span class="p">.</span><span class="n">Field</span><span class="p">));</span>
      <span class="k">else</span>
        <span class="n">criteria</span><span class="p">.</span><span class="nf">AddOrder</span><span class="p">(</span><span class="n">Order</span><span class="p">.</span><span class="nf">Desc</span><span class="p">(</span><span class="n">sort</span><span class="p">.</span><span class="n">Field</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">criteria</span><span class="p">.</span><span class="n">List</span><span class="p">&lt;</span><span class="n">Customer</span><span class="p">&gt;();</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<p>The <code>CreateFilteredCriteria</code> method is doing most of the leg work. It takes creates an NHibernate criteria, then adds any filter criterions to it. It iterates the filters collection, checking their type and adding the appropriate NHibernate criterion. Simple!</p>

<h2 id="the-example-project">The example project</h2>

<p>I’ve attached a sample project that uses the grid to display a collection of customers that are paged and filtered. The example uses a SQLite database with NHibernate for data-access, I’ve done this to keep the extraneous code to a minimum.</p>

<h2 id="downloads">Downloads</h2>

<p>The DeleGrid is open-source under the <a href="http://en.wikipedia.org/wiki/BSD_license">new BSD License</a>; read the license for what you’re allowed to do.</p>

<p>You can download the source here: <a href="http://jagregory.googlecode.com/files/DeleGrid-1.1-source.zip">Download Source</a>.<br />
You can download the latest binary here: <a href="http://jagregory.googlecode.com/files/DeleGrid-1.1.zip">Download Binary</a>.<br />
You can download the example project here: <a href="http://jagregory.googlecode.com/files/DeleGridExample.zip">Download Example</a>.</p>

<p>The source is also accessible from Subversion at: <a href="http://jagregory.googlecode.com/svn/trunk/DeleGrid/">http://jagregory.googlecode.com/svn/trunk/DeleGrid/</a> (using user jagregory-read-only)</p>

 <a class="read-more" href="/writings/introducing-the-filterable-delegrid">Read more &raquo;</a>
        </section>
        <footer class="post-meta">
            
            
            <time class="post-date" datetime="2008-03-05">
                05 Mar 2008
            </time>
        </footer>
    </article>

    

    <nav class="pagination" role="pagination">
    
        
            <a class="newer-posts" href="/page12/" title="Previous Page">&laquo; Newer Posts</a>
      
    
    <span class="page-number"> Page 13 of 23 </span>
     
        <a class="older-posts" href="/page14/" title="Next Page">Older Posts &raquo;</a>
     
</nav>

</main>

    <footer class="site-footer clearfix">
      <section class="copyright">
        <a href="mailto:james@jagregory.com">James Gregory</a> &copy;
               &bull; All content licensed under <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">cc by-nc-sa 4.0</a>.
      </section>
    </footer>

    <script type="text/javascript" src="/js/jquery-1.11.1.min.js"></script>
    <script type="text/javascript" src="/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="/js/index.js"></script>
</body>
</html>
